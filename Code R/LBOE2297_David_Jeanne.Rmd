---
title: "Étude de la biodiversité des espaces verts sur le campus de Louvain-la-Neuve: type de gestion et réseaux plantes-pollinisateurs"
author: "Jeanne David"
date: '`r format(Sys.time(), "%d %B, %Y,%H:%M")`'
output:
  html_document: # options pour sortie HTML
    code_folding: hide #  Cache le code (mais permet de l'ouvrir :-)) 
    collapsed: yes # Crée un document unique 
    fig_caption: yes # Figures encapsulées ? 
    fig_height: 6 # Hauteur par défaut des figures
    fig_width: 7 # Largeur par défaut des figures
    highlight: tango # style de mise en valeur du code
    number_sections: yes # Ajout table des matières 
    theme: united  # Style du document
    toc: yes # Table des matiere 
    toc_depth: 6  # Profondeur de la table des matière
    toc_float: yes # table des matière flottante
  pdf_document: # options pour sorties pdf
    toc: yes
    toc_depth: '6'
  word_document: default
editor_options: 
  chunk_output_type: console
---
 <style>
  body {
  text-align: justify
  }
  </style>
```{r setup, include=FALSE, warning = F, message=FALSE}
#Installez des packages ci-dessous si ce n'est pas encore fait

# Librairies utiles en RMD
require(devtools)
require(markdown)
require(rmarkdown)
require(knitr) # Librairie utile quand on fait du RMD
require(pander) # Librairie pour afficher des tableaux RMD
knitr::opts_chunk$set(echo = TRUE)
# Librairies statistiques
require(pastecs) # librairie qui inclut la fonction de stat descriptive stat.desc et utile en écologie
# Librairies graphiques
require(FactoMineR)
require(factoextra)
require(ade4)
require(lme4)# Pour estimer des modèles mixtes
require(lmerTest)
require(emmeans) # pour effectuer des tests et contrastes dans les modèle lm et lmer
require(lsmeans)
require(multcomp)

# Librairies graphiques
require(ggplot2) # pour faire des plot de type ggplot
require(patchwork)  # pour mettre plusieurs ggplots en patwork sur un graphique
require(GGally)  # Wrapper de ggplot 2 pour faire des belles matrices de graphiques
require(gridExtra)  # pour arranger des ggplot en grilles avec finesse
library(ggstance)

# Librairie de lecture de données
require(readxl) # pour lire des fichiers Excel
library(tidyverse)
library(car)
library(ggpubr)
library(visreg)
library(ggResidpanel)
#library("kableExtra")
library(lubridate)
library(forcats)
library(plotly)
library(lemon)
library(jtools)
library(magick)
library(scales)


library("performance")
library("see")

library(vegan)
library(BiodiversityR)
library(corrplot)
library(igraph)
library(bipartite)

source("viz_coaiv.R")
```

# Préparation des données 
```{r Chargement des données}
# Chargement des données 
# Les .csv sont importés et stockés
Donnees_pres <- read.csv("Data/Donnees_pres_agg.csv", header = T, sep = ";", dec = ",", row.names = 2)
Donnees_pres <- as.data.frame(Donnees_pres)
FinJuil_AllPl <- read.csv("Data/FinjuilletAllplants.csv", header = T, sep = ";", dec = ",")
Interactions <- read.csv2("Data/Interactions.csv")
Site_gestion <- read.csv2("Data/Site_Gestion.csv")
Classes <- read.csv2("Data/Classes_poll.csv")
expe_Tonte <- read.csv("Data/Expe_tonte.csv", header = T, sep = ";", dec = ",")
```

Renommer les colonnes et mise en facteurs des variables 
```{r Prépa des données, class.source = 'fold-show'}
## Données prés
#Site_gestion_date = as.factor(Site_gestion_date),
Donnees_pres <-  Donnees_pres %>% 
  mutate(Site = as.factor(Site),
         Gestion_2 = as.factor(Gestion_2),
         Parcelle = as.factor(Parcelle),
         Gestion_3 = as.factor(Gestion_3),
         Gestion_4 = as.factor(Gestion_4),
         Mixte_isole = as.factor(Mixte_isole),
         Quartier = as.factor(Quartier),
         Jours = as.factor(Jours),
         Gestion_moment_4 = as.factor(Gestion_moment_4),
         Gestion_moment_5 = as.factor(Gestion_moment_5),
         Activite = as.factor(Activite),
         Periode = as.factor(Periode),
         Meteo = as.factor(Meteo))
#colnames(Donnees_pres)

Donnees_pres$Date <- dmy(Donnees_pres$Date)
# Donnees_pres$Heure_debut <- hms(Donnees_pres$Heure_debut)
# Donnees_pres$Heure_fin <- hms(Donnees_pres$Heure_fin)

levels(Donnees_pres$Periode) <- c("Juin", "Mi-juillet", "Fin juillet")
levels(Donnees_pres$Meteo) <- c("Alternances", "Nuageux", "Soleil")
levels(Donnees_pres$Mixte_isole) <- c("Isolé fauche", "Isolé tonte", "Mixte")
levels(Donnees_pres$Gestion_moment_4) <- c("Fauche", "Semé", "Tonte récente", "Tonte tardive")
levels(Donnees_pres$Gestion_moment_5) <- c("Fleuri", "Graminées", "Semé", "Tonte récente", "Tonte tardive")



## Inventaire
#Site_gestion_date,
Inventaire <- Donnees_pres %>% 
  select(Site,
         Nombre_quadrats,
         Gestion_2, Parcelle, Gestion_4,
         Mixte_isole,
         Area_gis_m_sq,
         #Green100, Building100, Impervious100,Natural100
         Quartier,
         Jours,
         Gestion_moment_4, Gestion_moment_5,
         Activite,
         Periode,
         Date, 
         Heure_debut, Heure_fin,
         Temperature, Meteo, 
         Achillea_millefolium:Vicia_tetrasperma_subsp._tetrasperma,
         Aglais_io:Volucella_zonaria)

Inventaire$Gestion_4 <- fct_relevel(Inventaire$Gestion_4, c("Graminees", "Fleuri", "Seme", "Tonte"))
Inventaire$Gestion_moment_5 <- fct_relevel(Inventaire$Gestion_moment_5, c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
Inventaire$Mixte_isole <- fct_relevel(Inventaire$Mixte_isole, c("Isolé fauche", "Mixte", "Isolé tonte"))
Inventaire$Activite <- fct_relevel(Inventaire$Activite, c("Nulle", "Moyenne", "Forte"))
Inventaire$Meteo <- fct_relevel(Inventaire$Meteo, c("Nuageux", "Alternances", "Soleil"))


## Fin juillet all plants
FinJuil_AllPl <-  FinJuil_AllPl %>% 
  mutate(Site = as.factor(Site),
         Gestion_2 = as.factor(Gestion_2), 
         Parcelle = as.factor(Parcelle),
         Gestion_4 = as.factor(Gestion_4),
         Mixte_isole = as.factor(Mixte_isole),
         Quartier = as.factor(Quartier),
         Jours = as.factor(Jours),
         Gestion_moment_4 = as.factor(Gestion_moment_4),
         Gestion_moment_5 = as.factor(Gestion_moment_5),
         Activite = as.factor(Activite),
         Periode = as.factor(Periode),
         Meteo = as.factor(Meteo))

FinJuil_AllPl$Date <- dmy(FinJuil_AllPl$Date)
FinJuil_AllPl$Heure_debut <- hms(FinJuil_AllPl$Heure_debut)
FinJuil_AllPl$Heure_fin <- hms(FinJuil_AllPl$Heure_fin)

levels(FinJuil_AllPl$Periode) <- c("Fin juillet")
levels(FinJuil_AllPl$Meteo) <- c("Alternances", "Nuageux", "Soleil")
levels(FinJuil_AllPl$Mixte_isole) <- c("Isolé fauche", "Isolé tonte", "Mixte")
levels(FinJuil_AllPl$Gestion_moment_4) <- c("Fauche", "Semé", "Tonte récente", "Tonte tardive")
levels(FinJuil_AllPl$Gestion_moment_5) <- c("Fleuri", "Graminées", "Semé", "Tonte récente", "Tonte tardive")

AllFinJuillet <- FinJuil_AllPl %>% 
  select(Site,
         nombre_quadrats,
         Gestion_2, Parcelle, Gestion_4,
         Mixte_isole,
         Area,
         #Green100, Building100, Impervious100,Natural100
         Quartier,
         Jours,
         Gestion_moment_4, Gestion_moment_5,
         Activite,
         Periode,
         Date, 
         Heure_debut, Heure_fin,
         Temperature, Meteo, 
         Achillea_millefolium:Vicia_tetrasperma_subsp._tetrasperma,
         Aglais_io:Volucella_zonaria)

AllFinJuillet$Gestion_4 <- fct_relevel(AllFinJuillet$Gestion_4, c("Graminees", "Fleuri", "Seme", "Tonte"))
AllFinJuillet$Gestion_moment_5 <- fct_relevel(AllFinJuillet$Gestion_moment_5, c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))


## Interactions
Interactions <-  Interactions %>% 
  mutate(Site_gestion_date_Quadrat = as.factor(Site_gestion_date_Quadrat),
         Sp_Plantes = as.factor(Sp_Plantes),
         Sp_Pollinisateurs = as.factor(Sp_Pollinisateurs))



## Site & Classes
colnames(Site_gestion)[1:2] <- c("Site_gestion_date_Quadrat", "Site_gestion_date")
Site_gestion <-  Site_gestion %>% 
  mutate(Site_gestion_date_Quadrat = as.factor(Site_gestion_date_Quadrat),
         Site_gestion_date = as.factor(Site_gestion_date))

colnames(Classes)[1] <- c("Sp_Pollinisateurs")
Classes <-  Classes %>% 
  mutate(Sp_Pollinisateurs = as.factor(Sp_Pollinisateurs) ,
         Classe_Poll = as.factor(Classe_Poll))
```


# Illustration et survol des données 
## Inventaires plantes et pollinisateurs
Définir une colonne Diversité spécifique (nombre d'espèces, richesse spécifique S) et Abondance des plantes et des pollinisateurs
```{r Richesse spécifique et Abondance, class.source = 'fold-show'}
Inventaire$S_Plant <- specnumber(Inventaire[19:67])
Inventaire$Ab_Plant <- rowSums(Inventaire[19:67])
Inventaire$S_Poll <- specnumber(Inventaire[68:166])
Inventaire$Ab_Poll <- rowSums(Inventaire[68:166])
```

Jeu de données simplifié et corrélations
```{r Inv corrplot, fig.width=7,fig.height=7, message = FALSE}
Inv <- Inventaire[,c(1:18,167:170)]

corrplot(cor(Inv[,c(7,17,19:22)]), order = "hclust", type = "upper", tl.col = "black")
```

### Statistiques descriptives
#### Graphiques
##### Types de gestion
```{r Graphes Gestion 2, fig.height=5, fig.width=8}
Inv %>% ggplot(aes (x = Gestion_2, y = S_Plant, color = Gestion_2)) + 
  geom_boxplot(alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "", y = "Richesse spécifique en plantes") +
  theme(legend.position = "none") +

Inv %>% ggplot(aes (x = Gestion_2, y = Ab_Plant, color = Gestion_2)) + 
  geom_boxplot(alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Abondance en plantes en fonction des types de gestion", 
    x = "", y = "Abondance en plantes") +
  theme(legend.position = "none") +

Inv %>% ggplot(aes (x = Gestion_2, y = S_Poll, color = Gestion_2)) + 
  geom_boxplot(alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en pollinisateurs") +
  theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Gestion_2, y = Ab_Poll, color = Gestion_2)) + 
  geom_boxplot(alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Abondance en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en pollinisateurs") +
  theme(legend.position = "none")
```

```{r Graphes Gestion 4, fig.height=5, fig.width=8}
Inv %>% ggplot(aes (x = Gestion_4, y = S_Plant)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "", y = "Richesse spécifique en plantes") +

Inv %>% ggplot(aes (x = Gestion_4, y = Ab_Plant)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "", y = "Abondance en plantes") +
  
Inv %>% ggplot(aes (x = Gestion_4, y = S_Poll)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en pollinisateurs") +
  
Inv %>% ggplot(aes (x = Gestion_4, y = Ab_Poll)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Abondance de pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en pollinisateurs")
```

```{r Graphes Gestion moment 4, fig.height=5, fig.width=8}
Inv %>% ggplot(aes (x = Gestion_moment_4, y = S_Plant)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "", y = "Richesse spécifique en plantes") +
    theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_4, y = Ab_Plant)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "", y = "Abondance en plantes") +
    theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_4, y = S_Poll)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en pollinisateurs", color = "Type de gestion") +
    theme(legend.position="bottom") +
  
Inv %>% ggplot(aes (x = Gestion_moment_4, y = Ab_Poll)) + 
  geom_boxplot(alpha = 0.70) + 
  labs(#title = "Abondance de pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en pollinisateurs", color = "Type de gestion") + 
    theme(legend.position="none")
```

```{r Graphes Gestion moment 5, fig.height=5, fig.width=8}
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Plant)) + 
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",#6dcf20
                                  "Tonte tardive" = "#2b790c")) + #12661f
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "", y = "Richesse spécifique en plantes") +
    theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Plant)) + 
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "", y = "Abondance en plantes") +
    theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Poll, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) + 
        scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en pollinisateurs") +
    theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Poll, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) + 
        scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  labs(#title = "Abondance de pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en pollinisateurs") +
    theme(legend.position = "none")
```


##### Selon la période 
```{r Graphes Période}
Inv %>% ggplot(aes (x = Periode, y = S_Plant)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) +
   scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Richesse spécifique en plantes en fonction de la période", 
    x = "", y = "Richesse spécifiqu en plantes") +
  theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Periode, y = Ab_Plant)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
     scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Abondance de plantes en fonction de la période",
    x = "", y = "Abondance en plantes") +
  theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Periode, y = S_Poll)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
     scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Richesse spécifique en pollinisateurs en fonction de la période",
    x = "Période", y = "Richesse spécifique en pollinisateurs") +
  theme(legend.position = "none") +
  
Inv %>% ggplot(aes (x = Periode, y = Ab_Poll)) +
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
     scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Abondance de pollinisateurs en fonction de la période", 
    x = "Période", y = "Abondance en pollinisateurs") +
  theme(legend.position = "none") 
```

```{r Graphes Période & Gestion moment 5, fig.height=5, fig.width=8}
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Plant)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
       scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "", y = "Richesse spécifique en plantes") +    
  theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Plant, color = Periode)) + 
  geom_boxplot(alpha = 0.70) + 
       scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "", y = "Abondance en plantes") +
  theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Poll, color = Periode)) + 
  geom_boxplot(alpha = 0.70) + 
       scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en pollinisateurs") +
    theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Poll, color = Periode)) +
  geom_boxplot(alpha = 0.70) + 
       scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(#title = "Abondance de pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en pollinisateurs", color = "Période") +
    theme(legend.position="bottom") 
```

```{r Graphes Période & Gestion moment 5bis, fig.height=5, fig.width=8}
Inv %>% ggplot(aes (x = Periode, y = S_Plant, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) + 
   scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "", y = "Richesse spécifique en plantes") +
    theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Periode, y = Ab_Plant, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) + 
   scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "", y = "Abondance en plantes") +
    theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Periode, y = S_Poll, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) + 
   scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Période", y = "Richesse spécifique en pollinisateurs") +
    theme(legend.position="none") +
  
Inv %>% ggplot(aes (x = Periode, y = Ab_Poll, color = Gestion_moment_5)) +
  geom_boxplot(alpha = 0.70) + 
   scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(#title = "Abondance de pollinisateurs en fonction des types de gestion", 
    x = "Période", y = "Abondance en pollinisateurs", color= "Type de gestion") + 
    theme(legend.position="bottom")
```

```{r Graphes Période barplot, message=FALSE, warning=FALSE, fig.height=5, fig.width=8}
#esquisse::esquisser()
Inv_tib <- as_tibble(Inv)
resum_invG2 <- Inv_tib %>% 
  group_by(Periode, Gestion_2) %>% 
  summarize(mean = mean(S_Plant),
            var=var(S_Plant),
            N=n()) %>% 
  mutate(CI_S=mean+qt(0.975, N-1)*sqrt(var/N),
         CI_I=mean-qt(0.975, N-1)*sqrt(var/N))
ggplot(resum_invG2, aes(x= Periode, y=mean, colour= Gestion_2, group = Gestion_2)) + 
  geom_errorbar(aes(ymin=CI_I, ymax=CI_S),width=.15,size = 1) +
  geom_point(size= 3) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  geom_line(size = 1)+
 labs(x = "Période", 
       y = "Richesse spécifique en plantes", 
       color = "Type de gestion") 


resum_inv_SPl <- Inv_tib %>% 
  group_by(Periode, Gestion_moment_5) %>% 
  summarize(mean = mean(S_Plant),
            var=var(S_Plant),
            N=n()) %>% 
  mutate(CI_S=mean+qt(0.975, N-1)*sqrt(var/N),
         CI_I=mean-qt(0.975, N-1)*sqrt(var/N))
resum_inv_APl <- Inv_tib %>% 
  group_by(Periode, Gestion_moment_5) %>% 
  summarize(mean = mean(Ab_Plant),
            var=var(Ab_Plant),
            N=n()) %>% 
  mutate(CI_S=mean+qt(0.975, N-1)*sqrt(var/N),
         CI_I=mean-qt(0.975, N-1)*sqrt(var/N))
resum_inv_SPo <- Inv_tib %>% 
  group_by(Periode, Gestion_moment_5) %>% 
  summarize(mean = mean(S_Poll),
            var=var(S_Poll),
            N=n()) %>% 
  mutate(CI_S=mean+qt(0.975, N-1)*sqrt(var/N),
         CI_I=mean-qt(0.975, N-1)*sqrt(var/N))
resum_inv_APo <- Inv_tib %>% 
  group_by(Periode, Gestion_moment_5) %>% 
  summarize(mean = mean(Ab_Poll),
            var=var(Ab_Poll),
            N=n()) %>% 
  mutate(CI_S=mean+qt(0.975, N-1)*sqrt(var/N),
         CI_I=mean-qt(0.975, N-1)*sqrt(var/N))

ggplot(resum_inv_SPl, aes(x= Periode, y=mean, colour= Gestion_moment_5, group = Gestion_moment_5)) +
  geom_errorbar(aes(ymin=CI_I, ymax=CI_S),width=.15,size = 1) +
  geom_point(size= 3) +
          scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  geom_line(size = 1)+
  labs(x = "Période", 
       y = "Richesse spécifique en plantes", 
       color = "Type de gestion") +
  theme(legend.position="none") +
ggplot(resum_inv_APl, aes(x= Periode, y=mean, colour= Gestion_moment_5, group = Gestion_moment_5)) +
  geom_errorbar(aes(ymin=CI_I, ymax=CI_S),width=.15,size = 1) +
  geom_point(size= 3) +
          scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  geom_line(size = 1)+
  labs(x = "Période", 
       y = "Abondance en plantes", 
       color = "Type de gestion") +
  theme(legend.position="none") +
ggplot(resum_inv_SPo, aes(x= Periode, y=mean, colour= Gestion_moment_5, group = Gestion_moment_5)) + 
  geom_errorbar(aes(ymin=CI_I, ymax=CI_S),width=.15,size = 1) +
  geom_point(size= 3) +
          scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  geom_line(size = 1)+
  labs(x = "Période", 
       y = "Richesse spécifique en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="none") +
ggplot(resum_inv_APo, aes(x= Periode, y=mean, colour= Gestion_moment_5, group = Gestion_moment_5)) + 
  geom_errorbar(aes(ymin=CI_I, ymax=CI_S),width=.15,size = 1) +
  geom_point(size= 3) +
          scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  geom_line(size = 1)+
  labs(x = "Période", 
       y = "Abondance en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="bottom")
```

##### Influences multi-factorielles
###### Météo
```{r Graphes meteo, message=FALSE, warning=FALSE, fig.height=5, fig.width=8}
ggplot(Inv) +
  aes(x = Meteo, y = Ab_Poll, color = Meteo) +
  geom_boxplot(alpha = 0.70) +
            scale_color_manual(values = c("Nuageux" = "#7f908c",
                                  "Alternances" = "#79ccbd",
                                  "Soleil" = "#fbcb09")) +
   labs(x = "Météo", 
       y = "Abondance en pollinisateurs") +
  theme(legend.position="none")
ggplot(Inv) +
  aes(x = Gestion_moment_5, y = Ab_Poll, color = Meteo) +
  geom_boxplot(alpha = 0.70) +
              scale_color_manual(values = c("Nuageux" = "#7f908c",
                                  "Alternances" = "#79ccbd",
                                  "Soleil" = "#fbcb09")) +
   labs(x = "Type de gestion", 
       y = "Abondance en pollinisateurs", 
       color = "Météo") +
  theme(legend.position="bottom")
```

###### Températures
```{r Graphes températures, message=FALSE, warning=FALSE, fig.height=5, fig.width=8}
ggplot(Inv) +
  aes(x = Temperature, y = Ab_Poll) +
  geom_point()+ 
  geom_smooth(se = T) + 
  labs(x = "Température", 
       y = "Abondance en pollinisateurs")
ggplot(Inv) +
  aes(x = Temperature, y = Ab_Poll, color = Gestion_moment_5) +
  geom_point()+ 
            scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  geom_smooth(se = F) + 
  labs(x = "Température", 
       y = "Abondance en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="bottom")
```

###### Activité anthropiques
```{r Graphes activité anthropique, message=FALSE, warning=FALSE, fig.height=5, fig.width=8}
ggplot(Inv) +
  aes(x = Activite, y = S_Poll) +
  geom_boxplot(alpha = 0.70)+
  labs(x = "Activité", 
       y = "Richesse spécifique en pollinisateurs") +
ggplot(Inv) +
  aes(x = Activite, y = Ab_Poll) +
  geom_boxplot(alpha = 0.70)+
  labs(x = "Activité", 
       y = "Abondance en pollinisateurs")

ggplot(Inv) +
  aes(x = Activite, y = Ab_Poll, color = Gestion_moment_5) +
  geom_boxplot(alpha = 0.70)+ 
              scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(x = "Activité", 
       y = "Abondance en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="bottom")


ggplot(Inv) +
  aes(x = Activite, y = S_Plant) +
  geom_boxplot(alpha = 0.70)+
  labs(x = "Activité", 
       y = "Richesse spécifique en plantes")+
ggplot(Inv) +
  aes(x = Activite, y = Ab_Plant) +
  geom_boxplot(alpha = 0.70)+
  labs(x = "Activité", 
       y = "Abondance en plantes")
ggplot(Inv) +
  aes(x = Activite, y = Ab_Plant, color = Gestion_moment_5) +
  geom_boxplot(alpha = 0.70)+
                scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(x = "Activité", 
       y = "Abondance en plantes", 
       color = "Type de gestion") +
  theme(legend.position="bottom")
```

###### Heure de la journée
```{r Graphes heure, warning=FALSE, fig.height=5, fig.width=8} 
ggplot(Inv) +
  aes(x = Heure_debut, y = Ab_Poll, color = Gestion_2) +
  geom_point() + 
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  scale_x_discrete(breaks = c("09:00:00","10:00:00","11:00:00","12:00:00","13:00:00","14:00:00","15:00:00","16:00:00", "17:00:00"),
                   #limits = c("09:00:00","10:00:00","11:00:00","12:00:00","13:00:00","14:00:00","15:00:00","16:00:00", "17:00:00")
                   ) +
  labs(x = "Heure", 
       y = "Abondance en pollinisateurs") 
  
ggplot(Inv) +
  aes(x = Heure_debut, y = Ab_Poll, color = Gestion_moment_5) +
  geom_point()+ 
        scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    scale_x_discrete(breaks = c("09:00:00","10:00:00","11:00:00","12:00:00","13:00:00","14:00:00","15:00:00","16:00:00", "17:00:00"),
                   #limits = c("09:00:00","10:00:00","11:00:00","12:00:00","13:00:00","14:00:00","15:00:00","16:00:00", "17:00:00")
                   ) +
  labs(x = "Heure", 
       y = "Abondance en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="bottom")

ggplot(Inv) +
  aes(x = Heure_fin, y = Ab_Poll, color = Gestion_2) +
  geom_point() + 
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  scale_x_discrete(breaks = c("09:30:00","10:30:00","11:30:00","12:30:00","13:30:00","14:30:00","15:35:00","16:30:00", "17:30:00"),
                   #limits = c("09:30:00","10:30:00","11:30:00","12:30:00","13:30:00","14:30:00","15:30:00","16:30:00", "17:30:00")
                   ) +
  labs(x = "Heure", 
       y = "Abondance en pollinisateurs") 
  
ggplot(Inv) +
  aes(x = Heure_fin, y = Ab_Poll, color = Gestion_moment_5) +
  geom_point()+ 
        scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    scale_x_discrete(breaks = c("09:30:00","10:30:00","11:30:00","12:30:00","13:30:00","14:30:00","15:35:00","16:30:00", "17:30:00"),
                   #limits = c("09:30:00","10:30:00","11:30:00","12:30:00","13:30:00","14:30:00","15:30:00","16:30:00", "17:30:00")
                   ) +
  labs(x = "Heure", 
       y = "Abondance en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="bottom")
```

#### Statistiques par groupes
Création d'une fonction pour faire des statistiques descriptives par groupe
```{r Stat By Group G5, warning=FALSE}
statdesbygroup=function(Y, X)
  {# 1. On récupére les niveaux de X et le nombre de niveaux
  X=as.factor(X)
  levX=levels(X)
  nlevX=length(levX)
# 2. On crée la matrice pour les statistique descriptive
  mesStats<-matrix(nrow=nlevX,ncol=7)
  colnames(mesStats)=c("N","Moyenne","Médiane","Ecart-type","Variance","Min","Max" )
  rownames(mesStats)=levels(Inv$Gestion_moment_5)
# 3. On calcule les statistiques descriptives
  for(i in 1:nlevX)
  {indlevel=which(X==levX[i])
    mesStats[i,]<-c(length(Y[indlevel]),mean(Y[indlevel]),median(Y[indlevel]),sd(Y[indlevel]),var(Y[indlevel]),min(Y[indlevel]), max(Y[indlevel]))}
# 4. On retourne les résultats 
  return(mesStats)
}


SBG_SPlant <- statdesbygroup(
  Y = c(Inv$S_Plant), 
  X = c(Inv$Gestion_moment_5))
SBG_SPlant 
# %>% 
#   kbl(caption = "Richesse spécifique de la flore") %>%
#   kable_classic(full_width = F, html_font = "Cambria") # %>% kable_styling() %>%
# save_kable(file = "Output/Tableau/table_SPlant.pdf")

SBG_AbPlant  <- statdesbygroup(
  Y = c(Inv$Ab_Plant), 
  X = c(Inv$Gestion_moment_5))
SBG_AbPlant 
# %>% 
#   kbl(caption = "Abondance de la flore") %>%
#   kable_classic(full_width = F, html_font = "Cambria") # %>%  kable_styling() %>%
   # save_kable(file = "Output/Tableau/table_AbPlant.pdf")


SBG_SPoll <- statdesbygroup(
  Y = c(Inv$S_Poll), 
  X = c(Inv$Gestion_moment_5)) 
SBG_SPoll
# %>% 
#   kbl(caption = "Richesse spécifique de la faune pollinisatrice") %>%
#   kable_classic(full_width = F, html_font = "Cambria") # %>% kable_styling() %>%
#    save_kable(file = "Output/Tableau/table_SPoll.pdf")

SBG_AbPoll <- statdesbygroup(
  Y = c(Inv$Ab_Poll), 
  X = c(Inv$Gestion_moment_5))
SBG_AbPoll 
# %>% 
#   kbl(caption = "Abondance de la faune pollinisatrice") %>%
#   kable_classic(full_width = F, html_font = "Cambria") # %>% kable_styling() %>%
#    save_kable(file = "Output/Tableau/table_AbPoll.pdf")
```

```{r Stat By Group Période, warning=FALSE}
statdesbygroup=function(Y, X)
  {# 1. On récupére les niveaux de X et le nombre de niveaux
  X=as.factor(X)
  levX=levels(X)
  nlevX=length(levX)
# 2. On crée la matrice pour les statistique descriptive
  mesStats<-matrix(nrow=nlevX,ncol=7)
  colnames(mesStats)=c("N","Moyenne","Médiane","Ecart-type","Variance","Min","Max" )
  rownames(mesStats)=levels(Inv$Periode)
# 3. On calcule les statistiques descriptives
  for(i in 1:nlevX)
  {indlevel=which(X==levX[i])
    mesStats[i,]<-c(length(Y[indlevel]),mean(Y[indlevel]),median(Y[indlevel]),sd(Y[indlevel]),var(Y[indlevel]),min(Y[indlevel]), max(Y[indlevel]))}
# 4. On retourne les résultats 
  return(mesStats)
}


SBG_SPlant_Periode <- statdesbygroup(
  Y = c(Inv$S_Plant), 
  X = c(Inv$Periode))
SBG_SPlant_Periode 
# %>% 
#   kbl(caption = "Richesse spécifique de la flore") %>%
#   kable_classic(full_width = F, html_font = "Cambria")  #  %>% kable_styling() %>%
# save_kable(file = "Output/Tableau/table_SPlant_Periode.pdf")

SBG_AbPlant_Periode  <- statdesbygroup(
  Y = c(Inv$Ab_Plant), 
  X = c(Inv$Periode))
SBG_AbPlant_Periode 
# %>% 
#   kbl(caption = "Abondance de la flore") %>%
#   kable_classic(full_width = F, html_font = "Cambria") #  %>%  kable_styling() %>%
 #    save_kable(file = "Output/Tableau/table_AbPlant_Periode.pdf")


SBG_SPoll_Periode <- statdesbygroup(
  Y = c(Inv$S_Poll), 
  X = c(Inv$Periode)) 
SBG_SPoll_Periode 
# %>% 
#   kbl(caption = "Richesse spécifique de la faune pollinisatrice") %>%
#   kable_classic(full_width = F, html_font = "Cambria")#  %>% kable_styling() %>%
 #   save_kable(file = "Output/Tableau/table_SPoll_Periode.pdf")

SBG_AbPoll_Periode <- statdesbygroup(
  Y = c(Inv$Ab_Poll), 
  X = c(Inv$Periode))
SBG_AbPoll_Periode 
# %>% 
#   kbl(caption = "Abondance de la faune pollinisatrice") %>%
#   kable_classic(full_width = F, html_font = "Cambria") # %>% kable_styling() %>%
 # save_kable(file = "Output/Tableau/table_AbPoll_Periode.pdf")
```

### Courbes d'accumulation
```{r Prépa données courbes accumulation}
#Préparations données
especes <- Inventaire[,c(19:166)]

Esp_Plant <- Inventaire[,c(19:67)]
Esp_Poll <- Inventaire[,c(68:166)]

Inv_red <- Inventaire[,c(3:5,10:11,13:14,167:170)]
```

#### Plantes
```{r Courbes accumulation plantes G2 Gm5, fig.height=5, fig.width=8}
# accumcomp(Esp_Plant, y = Inv_red, factor = "Gestion_2", col = c("#aa1e0f","#12661f"), rainbow = F, xlim = c(1,90), plotit = TRUE, labelit = F, legend = F, xlab = "Nombre d'échantillonnages", ylab = "Nombre d'espèces")[1]
# legend("topright", legend = c("Fauche", "Tonte"), col = c("#aa1e0f", "#12661f"), lty = 1, xpd = TRUE, inset = c(0,-0.2), horiz = F)

Accum.Plantes_G2 <- accumcomp(Esp_Plant, y=Inv_red, factor='Gestion_2',
    method='exact', conditioned=FALSE, plotit=FALSE)
accum.long_Plantes_G2 <- accumcomp.long(Accum.Plantes_G2, ci=NA, label.freq=1)
plG2 <- ggplot(data=accum.long_Plantes_G2, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Plantes_G2, labelit==TRUE), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
      scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
    labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") + 
  theme(legend.position = "bottom")

# accumcomp(Esp_Plant, y = Inv_red, factor = "Gestion_moment_5", col = c("darkgreen", "green"), xlim = c(1,70), plotit = T, labelit = F, rainbow = F, legend = F, xlab = "Nombre d'échantillonages", ylab = "Nombre d'espèces")[1] 
# legend("topright", legend = c("Fleuri", "Graminées", "Semé","Tonte récente", "Tonte tardive"), col = rainbow(5), lty = 1, xpd = TRUE, inset = c(0,-0.2), horiz = F)

Accum.Plantes_G5 <- accumcomp(Esp_Plant, y=Inv_red, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)
accum.long_Plantes_G5 <- accumcomp.long(Accum.Plantes_G5, ci=NA, label.freq=1)
accum.long_Plantes_G5$Grouping <-  fct_relevel(accum.long_Plantes_G5$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
plG5 <- ggplot(data=accum.long_Plantes_G5, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Plantes_G5, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "bottom")

plG2 + plG5
```

##### Périodes
```{r}
# Juin
Inv_Juin <- Inv_red %>% 
  filter(Periode == "Juin")
Esp_Plant_Juin <- Esp_Plant %>% 
  rownames_to_column(var = "temp") %>% 
  filter(grepl("Juin$", temp)) %>% 
    column_to_rownames(var = "temp")

Accum.Plantes_Juin <- accumcomp(Esp_Plant_Juin, y=Inv_Juin, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)


accum.long_Plantes_Juin <- accumcomp.long(Accum.Plantes_Juin, ci=NA, label.freq=1)
accum.long_Plantes_Juin$Grouping <-  fct_relevel(accum.long_Plantes_Juin$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
pl_Juin <- ggplot(data=accum.long_Plantes_Juin, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Plantes_Juin, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "none")



# mi Juillet
Inv_miJuillet <- Inv_red %>% 
  filter(Periode == "Mi-juillet")
Esp_Plant_miJuillet <- Esp_Plant %>% 
  rownames_to_column(var = "temp") %>% 
  filter(grepl("miJuillet$", temp)) %>% 
    column_to_rownames(var = "temp")

Accum.Plantes_miJuillet <- accumcomp(Esp_Plant_miJuillet, y=Inv_miJuillet, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)


accum.long_Plantes_miJuillet <- accumcomp.long(Accum.Plantes_miJuillet, ci=NA, label.freq=1)
accum.long_Plantes_miJuillet$Grouping <-  fct_relevel(accum.long_Plantes_miJuillet$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
pl_miJuillet <- ggplot(data=accum.long_Plantes_miJuillet, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Plantes_miJuillet, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "bottom",
       # axis.title.x=element_blank(),
        axis.title.y=element_blank())


# fin Juillet
Inv_finJuillet <- Inv_red %>% 
  filter(Periode == "Fin juillet")
Esp_Plant_finJuillet <- Esp_Plant %>% 
  rownames_to_column(var = "temp") %>% 
  filter(grepl("finJuillet$", temp)) %>% 
    column_to_rownames(var = "temp")

Accum.Plantes_finJuillet <- accumcomp(Esp_Plant_finJuillet, y=Inv_finJuillet, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)


accum.long_Plantes_finJuillet <- accumcomp.long(Accum.Plantes_finJuillet, ci=NA, label.freq=1)
accum.long_Plantes_finJuillet$Grouping <-  fct_relevel(accum.long_Plantes_finJuillet$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
pl_finJuillet <- ggplot(data=accum.long_Plantes_finJuillet, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Plantes_finJuillet, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "none",
        axis.title.y=element_blank())



ggarrange(pl_Juin, pl_miJuillet, pl_finJuillet, ncol = 3, common.legend = TRUE, legend="bottom") 
ggarrange(pl_Juin, pl_miJuillet, pl_finJuillet, ncol = 1, common.legend = TRUE, legend="bottom")
```


#### Pollinisateurs
```{r Courbes accumulation pollinisateurs G2 Gm5, fig.height=5, fig.width=8}
# accumcomp(Esp_Poll, y = Inv_red, factor = "Gestion_2", xlim = c(1,90), plotit = T, labelit = F, rainbow = T, legend = F, xlab = "Nombre d'échantillonages", ylab = "Nombre d'espèces")[1] 
# legend("topright", legend = c("Fauche", "Tonte"), col = rainbow(2), lty = 1, xpd = TRUE, inset = c(0,-0.2), horiz = F)

Accum.Poll_G2 <- accumcomp(Esp_Poll, y=Inv_red, factor='Gestion_2',
    method='exact', conditioned=FALSE, plotit=FALSE)
accum.long_Poll_G2 <- accumcomp.long(Accum.Poll_G2, ci=NA, label.freq=1)
pollG2 <- ggplot(data=accum.long_Poll_G2, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Poll_G2, labelit==TRUE), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 4)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
    labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") + 
  theme(legend.position = "bottom")

# accumcomp(Esp_Poll, y = Inv_red, factor = "Gestion_moment_5", col = c("blue"), xlim = c(1,70), xlab = "Nombre d'échantillonages", ylab = "Nombre d'espèces", plotit = T, labelit = F, legend = F, rainbow = F)[1] 
# legend("topright", legend = c("Fleuri", "Graminées", "Semé","Tonte récente", "Tonte tardive"), col = rainbow(5), lty = 1, xpd = TRUE, inset = c(0,-0.2), horiz = F)

Accum.Poll_G5 <- accumcomp(Esp_Poll, y=Inv_red, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)
accum.long_Poll_G5 <- accumcomp.long(Accum.Poll_G5, ci=NA, label.freq=1)
accum.long_Poll_G5$Grouping <-  fct_relevel(accum.long_Poll_G5$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))

pollG5 <- ggplot(data=accum.long_Poll_G5, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Poll_G5, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 15,
                                  "Semé" = 17,
                                  "Tonte récente" = 4,
                                  "Tonte tardive" = 8)) + 
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "bottom")

pollG2 + pollG5
```

##### Périodes
```{r}
# Juin
Inv_Juin <- Inv_red %>% 
  filter(Periode == "Juin")
Esp_Poll_Juin <- Esp_Poll %>% 
  rownames_to_column(var = "temp") %>% 
  filter(grepl("Juin$", temp)) %>% 
    column_to_rownames(var = "temp")

Accum.Poll_Juin <- accumcomp(Esp_Poll_Juin, y=Inv_Juin, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)


accum.long_Poll_Juin <- accumcomp.long(Accum.Poll_Juin, ci=NA, label.freq=1)
accum.long_Poll_Juin$Grouping <-  fct_relevel(accum.long_Poll_Juin$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
poll_Juin <- ggplot(data=accum.long_Poll_Juin, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Poll_Juin, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "", y = "Nombre de taxa de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "none")



# mi Juillet
Inv_miJuillet <- Inv_red %>% 
  filter(Periode == "Mi-juillet")
Esp_Poll_miJuillet <- Esp_Poll %>% 
  rownames_to_column(var = "temp") %>% 
  filter(grepl("miJuillet$", temp)) %>% 
    column_to_rownames(var = "temp")

Accum.Poll_miJuillet <- accumcomp(Esp_Poll_miJuillet, y=Inv_miJuillet, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)


accum.long_Poll_miJuillet <- accumcomp.long(Accum.Poll_miJuillet, ci=NA, label.freq=1)
accum.long_Poll_miJuillet$Grouping <-  fct_relevel(accum.long_Poll_miJuillet$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
poll_miJuillet <- ggplot(data=accum.long_Poll_miJuillet, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Poll_miJuillet, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "Nombre d'échantillonages", y = "Nombre de taxa de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "bottom",
       # axis.title.x=element_blank(),
        axis.title.y=element_blank())


# fin Juillet
Inv_finJuillet <- Inv_red %>% 
  filter(Periode == "Fin juillet")
Esp_Poll_finJuillet <- Esp_Poll %>% 
  rownames_to_column(var = "temp") %>% 
  filter(grepl("finJuillet$", temp)) %>% 
    column_to_rownames(var = "temp")

Accum.Poll_finJuillet <- accumcomp(Esp_Poll_finJuillet, y=Inv_finJuillet, factor='Gestion_moment_5',
    method='exact', conditioned=FALSE, plotit=FALSE)


accum.long_Poll_finJuillet <- accumcomp.long(Accum.Poll_finJuillet, ci=NA, label.freq=1)
accum.long_Poll_finJuillet$Grouping <-  fct_relevel(accum.long_Poll_finJuillet$Grouping,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
poll_finJuillet <- ggplot(data=accum.long_Poll_finJuillet, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Poll_finJuillet, labelit==T), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
    scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
    labs(x = "", y = "Nombre de taxa de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = "none",
        axis.title.y=element_blank())



ggarrange(poll_Juin, poll_miJuillet, poll_finJuillet, ncol = 3, common.legend = TRUE, legend="bottom") 
ggarrange(poll_Juin, poll_miJuillet, poll_finJuillet, ncol = 1, common.legend = TRUE, legend="bottom")
```



### Catégories de pollinisateurs
```{r Inventaire classes pollinisateurs, class.source = 'fold-show'}
Inv_Classes_pl <- Inventaire %>% 
  rownames_to_column(var="Site_gestion_date") %>% 
  select(Site_gestion_date, Aglais_io:Volucella_zonaria) %>% 
  pivot_longer(cols = Aglais_io:Volucella_zonaria,
               names_to = "Sp_poll",
               values_to = "Donnees") %>% 
  mutate(Sp_poll = as.factor(Sp_poll))

Inv_Classes_join_pw <- left_join(Inv_Classes_pl, Classes, by = c("Sp_poll" = "Sp_Pollinisateurs")) %>% 
   pivot_wider(names_from = Classe_Poll,
              values_from = Donnees,
              values_fill = 0) %>% 
  select(-Sp_poll)
Inv_Classes <- aggregate(.~ Site_gestion_date, data=Inv_Classes_join_pw, FUN=sum)

Inv_noms <- Inventaire %>% 
  rownames_to_column(var="Site_gestion_date") %>% 
  select(Site, Site_gestion_date,
         Nombre_quadrats,
         Gestion_2, Parcelle, Gestion_4,
         Mixte_isole,
         Gestion_moment_4, Gestion_moment_5,
         Periode,
         Area_gis_m_sq,
         Quartier,
         Activite,
         Temperature, Meteo)

Inv_fulljoin <- full_join(Site_gestion, Inv_noms, by = "Site_gestion_date") %>% 
  select(-Site_gestion_date_Quadrat) %>% 
  distinct(Site_gestion_date, .keep_all = TRUE)

Inventaire_Classes <- full_join(Inv_fulljoin, Inv_Classes, by = "Site_gestion_date")

Inventaire_Classes$S_class <- specnumber(Inventaire_Classes[16:21])
Inventaire_Classes$Ab_class <- rowSums(Inventaire_Classes[16:21])
```



## Réseaux d'interactions
### Préparation des données et tests
```{r Prépa données réseaux}
Inv_noms <- Inventaire %>% 
  rownames_to_column(var="Site_gestion_date") %>% 
  select(Site, Site_gestion_date,
         Nombre_quadrats,
         Gestion_2, Parcelle, Gestion_4,
         Mixte_isole,
         Gestion_moment_4, Gestion_moment_5,
         Periode,
         Area_gis_m_sq,
         Quartier,
         Activite,
         Temperature, Meteo)

Inv_fulljoin <- full_join(Site_gestion, Inv_noms, by = "Site_gestion_date")

Interactions_Gestion <- full_join(Inv_fulljoin, Interactions, by = "Site_gestion_date_Quadrat")

Interactions_Classes <- left_join(Interactions_Gestion, Classes, by = "Sp_Pollinisateurs")

Interactions_Gestion$Sp_Plantes <- sub("_", " ", Interactions_Gestion$Sp_Plantes)
Interactions_Gestion$Sp_Pollinisateurs <- sub("_", " ", Interactions_Gestion$Sp_Pollinisateurs)
Interactions_Gestion$Sp_Plantes <- sub("_", " - ", Interactions_Gestion$Sp_Plantes)
Interactions_Gestion$Sp_Pollinisateurs <- sub("_", " - ", Interactions_Gestion$Sp_Pollinisateurs)
Interactions_Gestion$Sp_Plantes <- sub("._", " ", Interactions_Gestion$Sp_Plantes)
Interactions_Gestion$Sp_Plantes <- sub("_", " ", Interactions_Gestion$Sp_Plantes)
Interactions_Gestion$Sp_Pollinisateurs <- sub("_", " ", Interactions_Gestion$Sp_Pollinisateurs)

Interactions_Classes$Sp_Plantes <- sub("_", " ", Interactions_Classes$Sp_Plantes)
Interactions_Classes$Sp_Pollinisateurs <- sub("_", " ", Interactions_Classes$Sp_Pollinisateurs)
Interactions_Classes$Sp_Plantes <- sub("_", " - ", Interactions_Classes$Sp_Plantes)
Interactions_Classes$Sp_Pollinisateurs <- sub("_", " - ", Interactions_Classes$Sp_Pollinisateurs)
Interactions_Classes$Sp_Plantes <- sub("._", " ", Interactions_Classes$Sp_Plantes)
Interactions_Classes$Sp_Plantes <- sub("_", " ", Interactions_Classes$Sp_Plantes)
Interactions_Classes$Sp_Pollinisateurs <- sub("_", " ", Interactions_Classes$Sp_Pollinisateurs)
```

#### Tests
```{r Réseaux test, message=FALSE, eval=FALSE}
Interact_esp <- Interactions_Gestion %>% 
  group_by(Site_gestion_date, Sp_Plantes, Sp_Pollinisateurs) %>% 
  summarise(sum = sum(N_Interactions)) %>% 
  mutate(sum = as.numeric(sum))

network_Hemptinne_Tonte_Juin <- Interact_esp %>% 
  filter(Site_gestion_date == "Hemptinne_Tonte_Juin") %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  arrange(Sp_Plantes)

network_Mendel_Tonte_finJuillet <- Interact_esp %>% 
  filter(Site_gestion_date == "Mendel_Tonte_finJuilllet") %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  column_to_rownames(var="Sp_Plantes")


network_Reaumur_Fauche_miJuillet <- Interact_esp %>% 
  filter(Site_gestion_date == "Reaumur_Fauche_miJuillet") %>% 
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Site_gestion_date) %>% 
  column_to_rownames(var="Sp_Plantes")

network_Reaumur_Fauche_miJuillet
# %>% 
#   kbl() %>% 
#   kable_classic(full_width = F, html_font = "Cambria")
```

```{r Plotweb test, eval=FALSE}
plotweb(network_Reaumur_Fauche_miJuillet, text.rot = 90,y.width.high=0.07, y.width.low=0.07,y.lim=c(-0.5,2))

#plotweb(network_Reaumur_Fauche_miJuillet,col.high=rainbow(15),col.low=rainbow(8),text.rot=0,y.width.high=0.07, y.width.low=0.07,y.lim=c(-0.5,2))

networklevel(network_Reaumur_Fauche_miJuillet)
# %>% 
#   kbl() %>% 
#   kable_classic(full_width = F, html_font = "Cambria") 
```


### Interactions
```{r, message=FALSE, warning=FALSE}
Interactions_Gestion %>% ggplot(aes (x = Gestion_2, y = N_Interactions, color = Gestion_2)) + 
  geom_boxplot(alpha = 0.70) +
  facet_wrap(~ Periode) + 
   scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  theme(legend.position = "none") +
  
Interactions_Gestion %>% ggplot(aes (x = Periode, y = N_Interactions, color = Periode)) + 
  geom_boxplot(alpha = 0.70) +
  facet_wrap(~ Gestion_2) + 
      scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  theme(legend.position = "none") 

Interactions_Gestion %>% ggplot(aes (x = Gestion_moment_5, y = N_Interactions, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) +
  facet_wrap(~ Periode) + 
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme(legend.position = "none") +
  
Interactions_Gestion %>% ggplot(aes (x = Periode, y = N_Interactions, color = Periode)) + 
  geom_boxplot(alpha = 0.70) +
  facet_wrap(~ Gestion_moment_5) + 
      scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  theme(legend.position = "none") 

Interactions_Gestion %>% ggplot(aes (x = Gestion_moment_5, y = N_Interactions, color = Periode)) + 
  geom_boxplot(alpha = 0.70) +
   scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) + 
  theme(legend.position = "none") +

Interactions_Gestion %>% ggplot(aes (x = Periode, y = N_Interactions, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme(legend.position = "none") 
    
Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Gestion_moment_5, y = n, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) +
  facet_wrap(~ Periode) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme(legend.position = "none") +
  
Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Periode, y = n, color = Periode)) + 
  geom_boxplot(alpha = 0.70) +
  facet_wrap(~ Gestion_moment_5) +
   scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) + 
  theme(legend.position = "none") 

Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Periode, y = n, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme(legend.position = "none") +
  
Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Gestion_moment_5, y = n, color = Periode)) + 
  geom_boxplot(alpha = 0.70) +
   scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) + 
  theme(legend.position = "none") 


Interactions_Gestion %>% ggplot(aes (x = Qtte_Plantes, y = N_Interactions, color = Gestion_moment_5)) + 
  geom_point() + 
  geom_smooth(method = "glm", se = T) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme(legend.position = "none") 
```

### For-Loop réseaux
```{r Loop for Site, eval = FALSE,  class.source = 'fold-show'}
Loop <-  Interactions_Gestion %>% 
  filter(Site_gestion_date != "Aula_Tonte_miJuillet",
         Site_gestion_date != "AvGL_Tonte_finJuillet",
         Site_gestion_date != "AvGL_Tonte_miJuillet",
         Site_gestion_date != "BlancsChevaux_Tonte_finJuillet",
         Site_gestion_date != "BlancsChevaux_Tonte_miJuillet",
         Site_gestion_date != "Curie_Tonte_miJuillet",
         Site_gestion_date != "Gare_bus_Tonte_finJuillet",
         Site_gestion_date != "Lauzelle_Fauche_Juin",
         Site_gestion_date != "Lauzelle_Fauche_miJuillet",
         Site_gestion_date != "Lavoisier_Fauche_miJuillet",
         Site_gestion_date != "Mendel_Tonte_finJuillet",
         Site_gestion_date != "Mendel_Tonte_miJuillet",
         Site_gestion_date != "Parc_Lapins_Fauche_Juin",
         Site_gestion_date != "Parc_Lapins_Fauche_miJuillet") %>% 
  mutate(Site_gestion_date = as.factor(Site_gestion_date),
         Sp_Plantes = as.factor(Sp_Plantes),
         Sp_Pollinisateurs = as.factor(Sp_Pollinisateurs))

loop_sum <- Loop %>% 
  group_by(Site_gestion_date, Sp_Plantes, Sp_Pollinisateurs) %>% 
  summarise(sum = sum(N_Interactions))

col_names <- colnames(loop_sum)
col_names <- col_names[-1]

par(font = 3)


for (x in levels(loop_sum$Site_gestion_date)) {
  pdf(paste0("Output/Reseaux_loop/Plots/", x, ".pdf")) # ouvrir le fichier
  plot_nw <- plotweb(loop_sum %>% 
                       filter(Site_gestion_date == x) %>% 
                       filter(sum!=0) %>% 
                       select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
                       arrange(Sp_Pollinisateurs) %>% 
                       pivot_wider(names_from = Sp_Pollinisateurs,
                                   values_from = sum,
                                   values_fill = 0) %>% 
                       select(where(~ any(. != 0))) %>% 
                       arrange(Sp_Plantes) %>% 
                       as.data.frame() %>%
                       select(-Site_gestion_date) %>% 
                       column_to_rownames(var="Sp_Plantes"), 
                     high.lablength= 35, low.lablength=27,
                     text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
  plot_nw # imprimer le graphique
  dev.off() # fermer le fichier 
}

for (x in levels(loop_sum$Site_gestion_date)) {
  nw_lv <- networklevel(loop_sum %>% 
                       filter(Site_gestion_date == x) %>% 
                       filter(sum!=0) %>% 
                       select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
                       arrange(Sp_Pollinisateurs) %>% 
                       pivot_wider(names_from = Sp_Pollinisateurs,
                                   values_from = sum,
                                   values_fill = 0) %>% 
                       select(where(~ any(. != 0))) %>% 
                       arrange(Sp_Plantes) %>% 
                       as.data.frame() %>%
                       select(-Site_gestion_date) %>% 
                       column_to_rownames(var="Sp_Plantes"))
  write.csv2(nw_lv, file = paste0("Output/Reseaux_loop/Nw_Levels/", x, ".csv"))
}
```

### Fauche vs Tonte G2
```{r Réseaux Gestion 2, message=FALSE, fig.height=10, fig.width=15}
Interact_G2 <- Interactions_Gestion %>% 
  group_by(Gestion_2, Sp_Plantes, Sp_Pollinisateurs) %>% 
  summarise(sum = sum(N_Interactions)) %>% 
  mutate(sum = as.numeric(sum))

par(font = 3)
network_fauche <- Interact_G2 %>% 
  filter(Gestion_2 == "Fauche") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
# plotweb(network_fauche, high.lablength= 35, low.lablength=27, low.y = -0.1, high.y = 0.7, col.high=c("#aa1e0f"),col.low=c("#aa1e0f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,2.5))
plotweb(network_fauche, col.high=c("#aa1e0f"),col.low=c("#aa1e0f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
#plotweb(network_fauche,col.high=c("black","yellow"),col.low=c("light green", "dark green"),text.rot=90,y.width.high=0.07, y.width.low=0.07,y.lim=c(-1,3))
#plotweb(network_fauche,col.high=rainbow(47),col.low=rainbow(47),text.rot=90,y.width.high=0.07, y.width.low=0.07,y.lim=c(-1,3))

# #plotweb(network_fauche, method = "normal",
#         col.interaction=c(rep("grey50", 2),"darkgoldenrod1",rep("grey50", 2), "white"), 
#         col.high = c(rep("grey50", 2),"darkgoldenrod1",rep("grey50", 2), "white"),  
#         bor.col.high = c(rep("grey50", 2),"darkgoldenrod1",rep("grey50", 2) ,"white"),
#         bor.col.interaction = c(rep("grey50", 2),"darkgoldenrod1",rep("grey50", 2), "white"), 
#         col.low=c("black", "white"), bor.col.low = c("black", "white"), 
#         text.high.col = c(rep("black", 5), "white"), text.low.col =  c("black", "white"),
#         text.rot = 90)
#title(main = "Réseau d'interaction fauche")

# networklevel(network_fauche, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) %>% 
#   kbl() %>%
#   kable_classic(full_width = F, html_font = "Cambria")

network_tonte <- Interact_G2 %>% 
  filter(Gestion_2 == "Tonte") %>% 
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_tonte,col.high=c("#12661f"),col.low=c("#12661f"),text.rot=90,y.width.high=0.07, y.width.low=0.07,y.lim=c(-1,3.5))
#plotweb(network_tonte,col.high=rainbow(40),col.low=rainbow(10),text.rot=90,y.width.high=0.07, y.width.low=0.07,y.lim=c(-1,3))

# networklevel(network_tonte, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) %>% 
#   kbl() %>%
#   kable_classic(full_width = F, html_font = "Cambria")


Fauche <- networklevel(network_fauche, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) 
Tonte <- networklevel(network_tonte, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))
Table_NW_G2 <- cbind(Fauche, Tonte)
colnames(Table_NW_G2) <- c("Fauche", "Tonte")

Table_NW_G2
# %>% 
#   kbl(caption = "Gestion - biclassification") %>%
#   kable_classic(full_width = F, html_font = "Cambria")  #%>% kable_styling() %>%
# save_kable(file = "Output/Tableau/NW_G2.pdf")
```

```{r Réseaux Gestion 2 circle test, include = F}
i_net = graph_from_incidence_matrix(network_fauche, weight=T)
dev.off()

plot(i_net, layout=layout.bipartite)
plot(i_net, layout=layout.circle)

V(i_net)$frame.color = "white"
V(i_net)$label.color = "black"
plot(i_net,layout=layout.circle)
#help(layout)

#For degree centrality:
deg = centr_degree(i_net, mode="all")
V(i_net)$size = 5*sqrt(deg$res)
plot(i_net, layout=layout.circle)

polcol = rep("orange",dim(network_fauche)[2])
plantcol = rep("dark green",dim(network_fauche)[1])
clrs = rbind(as.matrix(plantcol),as.matrix(polcol))
V(i_net)$color = clrs
plot(i_net,layout=layout.circle)
```

### Gestion moment 5
```{r Réseaux Gestion m5, message=FALSE, fig.height=10, fig.width=15}
Interact_Gm5 <- Interactions_Gestion %>% 
  group_by(Gestion_moment_5, Sp_Plantes, Sp_Pollinisateurs) %>% 
  summarise(sum = sum(N_Interactions)) %>% 
  mutate(sum = as.numeric(sum))

par(font = 3)
network_gram <- Interact_Gm5 %>% 
  filter(Gestion_moment_5 == "Graminées") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_moment_5) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_gram, col.high=c("#fbcb09"),col.low=c("#fbcb09"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_gram, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_fleuri <- Interact_Gm5 %>% 
  filter(Gestion_moment_5 == "Fleuri") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_moment_5) %>% 
  column_to_rownames(var="Sp_Plantes")
# plotweb(network_fleuri, col.high=c("#ff7207"),col.low=c("#ff7207"),high.lablength= 30, low.lablength=35, low.y = -0.25, text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_fleuri, col.high=c("#ff7207"),col.low=c("#ff7207"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))

# networklevel(network_fleuri, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_seme <- Interact_Gm5 %>% 
  filter(Gestion_moment_5 == "Semé") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_moment_5) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_seme, col.high=c("#de1e21"),col.low=c("#de1e21"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_seme, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_TonRec <- Interact_Gm5 %>% 
  filter(Gestion_moment_5 == "Tonte récente") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_moment_5) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_TonRec, col.high=c("#6abe1d"), col.low=c("#6abe1d"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_TonRec, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_TonTard <- Interact_Gm5 %>% 
  filter(Gestion_moment_5 == "Tonte tardive") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Gestion_moment_5) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_TonTard, col.high=c("#2b790c"), col.low=c("#2b790c"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_TonTard, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))


Graminees <- networklevel(network_gram, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) %>% 
  as.data.frame()
Fleuri <- networklevel(network_fleuri, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))%>% 
  as.data.frame()
Seme <- networklevel(network_seme, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) %>% 
  as.data.frame()
Tonte_recente <- networklevel(network_TonRec, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))%>% 
  as.data.frame()
Tonte_tardive <- networklevel(network_TonTard, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) %>% 
  as.data.frame()

Table_NW_G5 <- cbind(Graminees, Fleuri, Seme, Tonte_recente, Tonte_tardive)
colnames(Table_NW_G5) <- c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive")
Table_NW_G5 
# %>%
#   kbl(caption = "Gestion - pentaclassification") %>%
#   kable_classic(full_width = F, html_font = "Cambria") 
```

### Période 
```{r Réseaux Période, message=FALSE, fig.height=10, fig.width=15}
Interact_Periode <- Interactions_Gestion %>% 
  group_by(Periode, Sp_Plantes, Sp_Pollinisateurs) %>% 
  summarise(sum = sum(N_Interactions)) %>% 
  mutate(sum = as.numeric(sum))

par(font = 3)

network_Juin <- Interact_Periode %>% 
  filter(Periode == "Juin") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_Juin, col.high=c("#74a9cf"), col.low=c("#74a9cf"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_Juin, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_miJuil <- Interact_Periode %>% 
  filter(Periode == "Mi-juillet") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_miJuil, col.high=c("#2b8cbe"), col.low=c("#2b8cbe"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_miJuil, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_finJuil <- Interact_Periode %>% 
  filter(Periode == "Fin juillet") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_finJuil, col.high=c("#045a8d"), col.low=c("#045a8d"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
# networklevel(network_finJuil, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))



juin <- networklevel(network_Juin, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) 
mijuillet <- networklevel(network_miJuil, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))
finjuillet <- networklevel(network_finJuil, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality")) 

Table_NW_P <- cbind(juin, mijuillet, finjuillet)
colnames(Table_NW_P) <- c("Juin", "Mi-juillet", "Fin juillet")
Table_NW_P 
# %>%
#   kbl(caption = "Période") %>%
#   kable_classic(full_width = F, html_font = "Cambria") 
```


### Période x Gestion moment 2 
```{r Réseaux Période G2, message=FALSE, fig.height=10, fig.width=15}
Interact_Periode_g2 <- Interactions_Gestion %>% 
  group_by(Periode, Gestion_2, Sp_Plantes, Sp_Pollinisateurs) %>% 
  summarise(sum = sum(N_Interactions)) %>% 
  mutate(sum = as.numeric(sum))

par(font = 3)

network_Juin_fauche <- Interact_Periode_g2 %>% 
  filter(Periode == "Juin" &
         Gestion_2 == "Fauche") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_Juin_fauche, col.high=c("#74a9cf","#aa1e0f"), col.low=c("#74a9cf","#aa1e0f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
networklevel(network_Juin_fauche, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_Juin_tonte <- Interact_Periode_g2 %>% 
  filter(Periode == "Juin" &
         Gestion_2 == "Tonte") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_Juin_tonte, col.high=c("#74a9cf","#12661f"), col.low=c("#74a9cf","#12661f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
networklevel(network_Juin_tonte, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))



network_miJui_fauche <- Interact_Periode_g2 %>% 
  filter(Periode == "Mi-juillet" &
         Gestion_2 == "Fauche") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_miJui_fauche, col.high=c("#2b8cbe","#aa1e0f"), col.low=c("#2b8cbe","#aa1e0f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
networklevel(network_miJui_fauche, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_miJui_tonte <- Interact_Periode_g2 %>% 
  filter(Periode == "Mi-juillet" &
         Gestion_2 == "Tonte") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_miJui_tonte, col.high=c("#2b8cbe","#12661f"), col.low=c("#2b8cbe","#12661f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
networklevel(network_miJui_tonte, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))



network_finJui_fauche <- Interact_Periode_g2 %>% 
  filter(Periode == "Fin juillet" &
         Gestion_2 == "Fauche") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_finJui_fauche, col.high=c("#045a8d","#aa1e0f"), col.low=c("#045a8d","#aa1e0f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
networklevel(network_finJui_fauche, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))

network_finJui_tonte <- Interact_Periode_g2 %>% 
  filter(Periode == "Fin juillet" &
         Gestion_2 == "Tonte") %>%
  filter(sum!=0) %>% 
  select(Sp_Pollinisateurs,Sp_Plantes,sum) %>% 
  arrange(Sp_Pollinisateurs) %>% 
  pivot_wider(names_from = Sp_Pollinisateurs,
              values_from = sum,
              values_fill = 0) %>% 
  select(where(~ any(. != 0))) %>% 
  arrange(Sp_Plantes) %>% 
  as.data.frame() %>%
  select(-Periode) %>% 
  select(-Gestion_2) %>% 
  column_to_rownames(var="Sp_Plantes")
plotweb(network_finJui_tonte, col.high=c("#045a8d","#12661f"), col.low=c("#045a8d","#12661f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3))
networklevel(network_finJui_tonte, index=c("connectance", "web asymmetry", "weighted nestedness", "linkage density", "Fisher alpha","Shannon diversity", "interaction evenness","H2","robustness", "robustness", "generality"))
```





## Expérience supplémentaire: Tonte
```{r Préparation données Tonte, results='hide',message=FALSE,warning=FALSE}
#Mise en facteur des variables 
expe_Tonte = expe_Tonte %>% 
  mutate(Site = as.factor(Site),
         Date = as.factor(Date))

#Tonte$Date <- dmy(Tonte$Date)
summary(expe_Tonte)

expe_Tonte$S <- specnumber(expe_Tonte[5:11])
expe_Tonte$Ab <- rowSums(expe_Tonte[5:11])


# mettre une ligne par espèce
Tonte_pl <- expe_Tonte %>%
  pivot_longer(cols = Bellis_perennis:Trifolium_repens,
               names_to = "Espèces",
               values_to = "Qtté")

Tonte_pl$Qtte_trans <- Tonte_pl$Qtté
Tonte_pl[Tonte_pl == 0] <- NA
```

```{r Graphes Tonte, include=FALSE}
expe_Tonte %>% ggplot(aes (x = Ab, y = Jour_af_tonte)) + 
  geom_line() + 
  
expe_Tonte %>% ggplot(aes (x = S, y = Jour_af_tonte)) + 
  geom_line() + 
  
expe_Tonte %>% ggplot(aes (x = Jour_af_tonte, y = S, color=Site)) + 
  geom_point() + 
  
expe_Tonte %>% ggplot(aes (x = Jour_af_tonte, y = S, color=Site)) + 
  geom_line()
  
```

```{r Graphes finaux Tonte, message=FALSE, warning=FALSE, fig.height=5, fig.width=8}
expe_Tonte %>% ggplot(aes (x = Jour_af_tonte, y = Ab, color=Site)) + 
  geom_line() +  
  labs(title = "Abondance de fleurs après la tonte selon les sites" , x = "Jour après la tonte", y = "Abondance de fleurs") +
      theme(legend.position="bottom") +
expe_Tonte %>% ggplot(aes (x = Jour_af_tonte, y = Ab, color=Site)) + 
  geom_smooth()+
  labs(title = "Abondance de fleurs après la tonte selon les sites" , x = "Jour après la tonte", y = "Abondance de fleurs") +
      theme(legend.position="none")

Tonte_pl %>% ggplot(aes (x = Jour_af_tonte, y = S)) + 
  facet_wrap(~Site) +
  geom_smooth(se = F)+
  labs(title = "Abondance de fleurs après la tonte selon les sites" , x = "Jour après la tonte", y = "Abondance de fleurs") +
      theme(legend.position="bottom") +
Tonte_pl %>% ggplot(aes (x = Jour_af_tonte, y = S, color = Site)) + 
  geom_point() +
  geom_smooth(se = F)+
  labs(title = "Richesse spécifique en fleurs après la tonte selon les sites" , x = "Jour après la tonte", y = "Richesse spécifique en fleurs") +
      theme(legend.position="bottom")

Tonte_pl %>% ggplot(aes (x = Jour_af_tonte, y = Qtté, color=Espèces)) + 
  geom_smooth(se=F)+
  labs(title = "Abondance de fleurs après la tonte selon les sites" , x = "Jour après la tonte", y = "Abondance de fleurs") +
      theme(legend.position="bottom") 


Tonte_pl %>% ggplot(aes (x = Jour_af_tonte, y = Qtté, color=Espèces)) + 
  facet_wrap(~Site) +
  geom_smooth(se = F)+
  labs(title = "Abondance de fleurs après la tonte selon les sites" , x = "Jour après la tonte", y = "Abondance de fleurs") +
      theme(legend.position="bottom")
```







# Statistiques 
## Multivariée
### ACP
#### ACP - Inv
```{r ACP Inv, warning=FALSE, message=FALSE}
gestion_2 <- as.factor(Inv$Gestion_2)
gestion_5 <- as.factor(Inv$Gestion_moment_5)
periode <- as.factor(Inv$Periode)
activite <- as.factor(Inv$Activite)
meteo <- as.factor(Inv$Meteo)
site <- as.factor(Inv$Site)
quartier <- as.factor(Inv$Quartier)

NumVar <- sapply(Inv, is.numeric)
df <- Inv[,NumVar] # %>% 
  # select(!c(Heure_fin,Heure_debut))
n <- nrow(df) 
p <- ncol(df)

acp <- dudi.pca(df, scannf = F, nf = p)
fviz_pca_biplot(acp)
screeplot(acp, main = "Valeurs propres")

fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen")) 

fviz_pca_var(acp, 
             col.var = "cos2", axes = c(2,3),
             title = "Cercle de corrélation et qualité de représentation dans le plan 2-3", 
             gradient.cols=c("red", "gold", "forestgreen")) 
fviz_pca_var(acp, 
             col.var = "cos2", axes = c(4,5),
             title = "Cercle de corrélation et qualité de représentation dans le plan 4-5",
             gradient.cols=c("red", "gold", "forestgreen")) 
fviz_pca_var(acp, 
             col.var = "cos2", axes = c(5,6),
             title = "Cercle de corrélation et qualité de représentation dans le plan 5-6", 
             gradient.cols=c("red", "gold", "forestgreen"))

fviz_pca_ind(acp, repel = T,
             labelsize = 2, 
             col.ind = "cos2", 
             gradient.cols=c("red", "gold", "forestgreen"),
             title = "Qualité de représentation des individus dans le plan 1-2")

fviz_pca_ind(acp, axes = c(2,3), 
             labelsize = 0, 
             col.ind = "cos2", 
             gradient.cols=c("red", "gold", "forestgreen"),
             title = "Qualité de représentation des individus dans le plan 2-3")


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_2, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_2") +
      aes(color = gestion_2, shape = gestion_2, fill = gestion_2) + 
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
   scale_fill_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_5, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_5") +
  aes(color = gestion_5, shape = gestion_5, fill = gestion_5)+ 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_fill_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = periode, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable periode") +
    aes(color = periode, shape = periode, fill = periode) +
      scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  scale_fill_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d"))


fviz_pca_ind(acp, col.var = "var",
             labelsize = 0, 
             col.ind = activite, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable activite") +
aes(color = activite, shape = activite, fill = activite) +
    scale_color_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) +
    scale_fill_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) 


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = meteo, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable meteo") +
    aes(color = meteo, shape = meteo, fill = meteo) +
    scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
    scale_fill_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = quartier, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable quartier") 

summary(acp)


A <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_2, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_2") +
      aes(color = gestion_2, shape = gestion_2, fill = gestion_2) + 
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
   scale_fill_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion")

B <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_5, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_5") +
    aes(color = gestion_5, shape = gestion_5, fill = gestion_5)+ 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_fill_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6))  +
  labs(color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion")


C <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = periode, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable periode") +
    aes(color = periode, shape = periode, fill = periode) +
      scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  scale_fill_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(color = "Période", fill = "Période", shape = "Période")

D <- fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen"))


(D+B)/(C+A) 

A <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = quartier, 
             addEllipses = T,
             palette = terrain.colors(10),
             title = "Position des individus dans le plan 1-2 selon la variable quartier") +
  labs(color = "Quartier", fill = "Quartier", shape = "Quartier")

B <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = activite, 
             addEllipses = T,
             #palette = terrain.colors(5),
             title = "Position des individus dans le plan 1-2 selon la variable activite") +
aes(color = activite, shape = activite, fill = activite) +
    scale_color_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) +
    scale_fill_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) +
  labs(color = "Activité", fill = "Activité", shape = "Activité")


C <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = meteo, 
             addEllipses = T,
             #palette = terrain.colors(5),
             title = "Position des individus dans le plan 1-2 selon la variable meteo") +
    aes(color = meteo, shape = meteo, fill = meteo) +
    scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
    scale_fill_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09"))  +
  labs(color = "Météo", fill = "Météo", shape = "Météo")

D <- fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen"))

(D+B)/(C+A) 
```

#### ACP - Classes
```{r ACP classes, warning=FALSE, message=FALSE}
Inventaire_Classes_acp <- Inventaire_Classes %>% 
  column_to_rownames(var="Site_gestion_date")
NumVar <- sapply(Inventaire_Classes_acp, is.numeric)
df <- Inventaire_Classes_acp[,NumVar] %>% 
  select(-S_class, -Ab_class)
n <- nrow(df) 
p <- ncol(df)
gestion_2 <- as.factor(Inventaire_Classes_acp$Gestion_2)
gestion_5 <- as.factor(Inventaire_Classes_acp$Gestion_moment_5)
periode <- as.factor(Inventaire_Classes_acp$Periode)
activite <- as.factor(Inventaire_Classes_acp$Activite)
meteo <- as.factor(Inventaire_Classes_acp$Meteo)
site <- as.factor(Inventaire_Classes_acp$Site)
quartier <- as.factor(Inventaire_Classes_acp$Quartier)



acp <- dudi.pca(df, scannf = F, nf = p)
fviz_pca_biplot(acp)
screeplot(acp, main = "Valeurs propres")

fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen")) 

fviz_pca_var(acp, 
             col.var = "cos2", axes = c(2,3),
             title = "Cercle de corrélation et qualité de représentation dans le plan 2-3", 
             gradient.cols=c("red", "gold", "forestgreen")) 


fviz_pca_ind(acp, repel = T,
             labelsize = 2, 
             col.ind = "cos2", 
             gradient.cols=c("red", "gold", "forestgreen"),
             title = "Qualité de représentation des individus dans le plan 1-2")

fviz_pca_ind(acp, axes = c(2,3), 
             labelsize = 0, 
             col.ind = "cos2", 
             gradient.cols=c("red", "gold", "forestgreen"),
             title = "Qualité de représentation des individus dans le plan 2-3")


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_2, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_2") +
    aes(color = gestion_2, shape = gestion_2, fill = gestion_2) + 
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
   scale_fill_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_5, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_5") +
    aes(color = gestion_5, shape = gestion_5, fill = gestion_5) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_fill_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) 


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = periode, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable periode") +
  aes(color = periode, shape = periode, fill = periode) +
      scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  scale_fill_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d"))


fviz_pca_ind(acp, col.var = "var",
             labelsize = 0, 
             col.ind = activite, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable activite") + 
  aes(color = activite, shape = activite, fill = activite) +
    scale_color_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) +
    scale_fill_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = meteo, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable meteo") +
  aes(color = meteo, shape = meteo, fill = meteo) +
    scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
    scale_fill_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) 


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = quartier, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable quartier") 

summary(acp)


A <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_2, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_2") +
    aes(color = gestion_2, shape = gestion_2, fill = gestion_2) + 
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
   scale_fill_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion")
 

B <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_5, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_5") +
    aes(color = gestion_5, shape = gestion_5, fill = gestion_5)+ 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_fill_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
  labs(color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion")



C <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = periode, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable periode") +
  aes(color = periode, shape = periode, fill = periode) +
      scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  scale_fill_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) +
  labs(color = "Période", fill = "Période", shape = "Période")

D <- fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen"))


(D+B)/(C+A) 

A <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = quartier, 
             addEllipses = T,
             palette = terrain.colors(10),
             title = "Position des individus dans le plan 1-2 selon la variable quartier")  +
  labs(color = "Quartier", fill = "Quartier", shape = "Quartier")

B <- fviz_pca_ind(acp,
             labelsize = 0, 
             col.ind = activite, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable activite") + 
  aes(color = activite, shape = activite, fill = activite) +
    scale_color_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) +
    scale_fill_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8"))  +
  labs(color = "Activité", fill = "Activité", shape = "Activité")

C <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = meteo, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable meteo") +
  aes(color = meteo, shape = meteo, fill = meteo) +
    scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
    scale_fill_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09"))  +
  labs(color = "Météo", fill = "Météo", shape = "Météo")

D <- fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen"))

(D+B)/(C+A) 
```


#### ACP - Fin juillet
```{r ACP Fin juillet, warning=FALSE, message=FALSE}
AllFinJuillet_acp<- AllFinJuillet[,c(4,19:68)] 
AllFinJuillet_acp <- AllFinJuillet_acp %>% 
  column_to_rownames(var="Parcelle")

NumVar <- sapply(AllFinJuillet_acp, is.numeric)
df <- AllFinJuillet_acp[,NumVar]
n <- nrow(df) 
p <- ncol(df)

gestion_2 <- as.factor(AllFinJuillet$Gestion_2)
gestion_5 <- as.factor(AllFinJuillet$Gestion_moment_5)
activite <- as.factor(AllFinJuillet$Activite)
meteo <- as.factor(AllFinJuillet$Meteo)
site <- as.factor(AllFinJuillet$Site)
quartier <- as.factor(AllFinJuillet$Quartier)

acp <- dudi.pca(df, scannf = F, nf = p)
fviz_pca_biplot(acp)
screeplot(acp, main = "Valeurs propres")

fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen")) 

fviz_pca_var(acp, 
             col.var = "cos2", axes = c(2,3),
             title = "Cercle de corrélation et qualité de représentation dans le plan 2-3", 
             gradient.cols=c("red", "gold", "forestgreen")) 


fviz_pca_ind(acp, repel = T,
             labelsize = 2, 
             col.ind = "cos2", 
             gradient.cols=c("red", "gold", "forestgreen"),
             title = "Qualité de représentation des individus dans le plan 1-2")

fviz_pca_ind(acp, axes = c(2,3), 
             labelsize = 0, 
             col.ind = "cos2", 
             gradient.cols=c("red", "gold", "forestgreen"),
             title = "Qualité de représentation des individus dans le plan 2-3")


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_2, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_2") +
      aes(color = gestion_2, shape = gestion_2, fill = gestion_2) + 
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
   scale_fill_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_5, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_5") +
    aes(color = gestion_5, shape = gestion_5, fill = gestion_5) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_fill_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) 


fviz_pca_ind(acp, col.var = "var",
             labelsize = 0, 
             col.ind = activite, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable activite") + 
  aes(color = activite, shape = activite, fill = activite) +
    scale_color_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) +
    scale_fill_manual(values = c("Forte" = "#3f007d",
                                "Moyenne" = "#6a51a3",
                                "Nulle" = "#9e9ac8")) 

fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = meteo, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable meteo") +
  aes(color = meteo, shape = meteo, fill = meteo) +
    scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
    scale_fill_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) 


fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = quartier, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable quartier") 

summary(acp)


A <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_2, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_2") +
    aes(color = gestion_2, shape = gestion_2, fill = gestion_2) + 
    scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
   scale_fill_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f"))  +
  labs(color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion")

B <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = gestion_5, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable gestion_5") +
    aes(color = gestion_5, shape = gestion_5, fill = gestion_5)+ 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_fill_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Graminées" = 16,
                                  "Fleuri" = 17,
                                  "Semé" = 15,
                                  "Tonte récente" = 5,
                                  "Tonte tardive" = 6)) +
  labs(color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion")

C <- fviz_pca_ind(acp, 
             labelsize = 0, 
             col.ind = meteo, 
             addEllipses = T,
             title = "Position des individus dans le plan 1-2 selon la variable meteo") +
  aes(color = meteo, shape = meteo, fill = meteo) +
    scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
    scale_fill_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09"))  +
  labs(color = "Météo", fill = "Météo", shape = "Météo")

D <- fviz_pca_var(acp, 
             col.var = "cos2", 
             title = "Cercle de corrélation et qualité de représentation dans le plan 1-2", 
             gradient.cols=c("red", "gold", "forestgreen"))


(D+B)/(C+A) 
```



### ACC
#### ACC - Sp plantes
```{r ACC Plantes, warning=FALSE, message=FALSE}
Y <- Esp_Plant
X <- Inv %>% 
  select(!c(Site, Parcelle,Gestion_2, Gestion_4, Gestion_moment_4, Date, Heure_debut, Heure_fin, Quartier, Meteo, Jours, Mixte_isole, Activite, Nombre_quadrats))

#dim(X) ; dim(Y) 
X<-X[rowSums(Y)!=0,]
Y<-Y[rowSums(Y)!=0,]
Y<-Y[,colSums(Y)!=0] 
n <- nrow(Y)
#n == nrow(X) 
p <- ncol(Y)
m <- ncol(X)
gestion_2 <- as.factor(X$Gestion_2)
gestion_5 <- as.factor(X$Gestion_moment_5)

afc_Y <- dudi.coa(Y,  scannf = FALSE, nf = p)
acc <- pcaiv(afc_Y, X,  scannf = FALSE, nf = m)

Q <- viz_coaiv(acc,"co") + 
  scale_x_continuous(limits=c(-1.5, 2))
viz_coaiv(acc,"li")
viz_coaiv(acc, "li", axes = c(2,3)) 

Z <-  viz_coaiv(acc, "ls")  + 
  scale_x_continuous(limits=c(-1.1, 1.9))
viz_coaiv(acc, "match")
viz_coaiv(acc, "fa") 

E <- viz_coaiv(acc, "cor")  + 
  scale_x_continuous(limits=c(-1.5, 1.5))
viz_coaiv(acc, "cor", axes=c(1,3)) 
viz_coaiv(acc, "li", axes = c(1,3))

R <- viz_coaiv(acc, "as") 
viz_coaiv(acc, "as", axes=c(2,3)) 

Z = Z + aes(color = gestion_5) + labs(title = "Position des parcelles", color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion") +
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme (legend.position = "bottom",
         text = element_text(size=12))
Q = Q + labs(title = "Position des espèces de plantes") +
   theme (legend.position = "bottom",
         text = element_text(size=12))
E= E + labs(title = "Variables explicatives") +
   theme (legend.position = "bottom",
         text = element_text(size=12))
R= R + labs(title = "Participations des axes à la dimention 1-2")

(Q + E) / (Z + R)
(Q + E) / (Z)
```

#### ACC - Sp poll
```{r ACC Poll, warning=FALSE, message=FALSE}
Y <- Esp_Poll
X <- Inv %>% 
  select(!c(Site, Parcelle,Gestion_2, Gestion_4, Gestion_moment_4, Date, Heure_debut, Heure_fin, Quartier, Meteo, Jours, Mixte_isole, Activite, Nombre_quadrats))

#dim(X) ; dim(Y) 
X<-X[rowSums(Y)!=0,]
Y<-Y[rowSums(Y)!=0,]
Y<-Y[,colSums(Y)!=0] 
n <- nrow(Y)
#n == nrow(X) 
p <- ncol(Y)
m <- ncol(X)
gestion_2 <- as.factor(X$Gestion_2)
gestion_5 <- as.factor(X$Gestion_moment_5)

afc_Y <- dudi.coa(Y,  scannf = FALSE, nf = p)
acc <- pcaiv(afc_Y, X,  scannf = FALSE, nf = m)

Q <- viz_coaiv(acc,"co") 
viz_coaiv(acc,"li")
viz_coaiv(acc, "li", axes = c(2,3))

Z <-  viz_coaiv(acc, "ls") 
viz_coaiv(acc, "match")
viz_coaiv(acc, "fa") 

E <- viz_coaiv(acc, "cor") 
viz_coaiv(acc, "cor", axes=c(1,3)) 
viz_coaiv(acc, "li", axes = c(1,3))

R <- viz_coaiv(acc, "as") 
viz_coaiv(acc, "as", axes=c(2,3)) 

Z = Z + aes(color = gestion_5) + labs(title = "Position des parcelles", color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion") + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) 
Q = Q + labs(title = "Position des espèces de pollinisateurs")
E= E + labs(title = "Variables explicatives")
R= R + labs(title = "Participations des axes à la dimention 1-2")

(Q + E) / (Z + R)
```

#### ACC - Classes poll
```{r ACC classes Poll, warning=FALSE, message=FALSE}
Inv_Classes_acp <- Inv_Classes %>% 
  column_to_rownames(var = "Site_gestion_date")
Y <- Inv_Classes_acp
X <- Inv %>% 
  select(!c(Site, Parcelle,Gestion_2, Gestion_4, Gestion_moment_4, Date, Heure_debut, Heure_fin, Quartier, Meteo, Jours, Mixte_isole, Activite, Nombre_quadrats))

#dim(X) ; dim(Y) 
X<-X[rowSums(Y)!=0,]
Y<-Y[rowSums(Y)!=0,]
Y<-Y[,colSums(Y)!=0] 
n <- nrow(Y)
#n == nrow(X) 
p <- ncol(Y)
m <- ncol(X)
gestion_2 <- as.factor(X$Gestion_2)
gestion_5 <- as.factor(X$Gestion_moment_5)

afc_Y <- dudi.coa(Y,  scannf = FALSE, nf = p)
acc <- pcaiv(afc_Y, X,  scannf = FALSE, nf = m)

Q <- viz_coaiv(acc,"co") 
viz_coaiv(acc,"li")
viz_coaiv(acc, "li", axes = c(2,3))

Z <-  viz_coaiv(acc, "ls") 
viz_coaiv(acc, "match")
viz_coaiv(acc, "fa") 

E <- viz_coaiv(acc, "cor") 
viz_coaiv(acc, "cor", axes=c(1,3)) 
viz_coaiv(acc, "li", axes = c(1,3))

R <- viz_coaiv(acc, "as") 
viz_coaiv(acc, "as", axes=c(2,3)) 

Z = Z + aes(color = gestion_5) + labs(title = "Position des parcelles", color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion") +
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) 
Q = Q + labs(title = "Position des catégories de pollinisateurs")
E= E + labs(title = "Variables explicatives")
R= R + labs(title = "Participations des axes à la dimention 1-2")

(Q + E) / (Z + R)
```

#### ACC - Fin juillet
```{r ACC All Plant fin juillet, warning=FALSE, message=FALSE}
fin_juil_espPl<- FinJuil_AllPl[,c(1,33:82)] %>% 
  column_to_rownames(var = "Site_gestion_date") 

Y <- fin_juil_espPl
X <- Inv %>% 
  filter(Periode=="Fin juillet") %>% 
  select(!c(Site, Parcelle, Gestion_2, Gestion_4, Gestion_moment_4, Date, Heure_debut, Heure_fin, Jours, Periode, Quartier, Meteo,Jours, Mixte_isole, Activite, Nombre_quadrats))

# dim(X) ; dim(Y) 
X<-X[rowSums(Y)!=0,]
Y<-Y[rowSums(Y)!=0,]
Y<-Y[,colSums(Y)!=0] 
n <- nrow(Y)
# n == nrow(X) 
p <- ncol(Y)
m <- ncol(X)
gestion_2 <- as.factor(X$Gestion_2)
gestion_5 <- as.factor(X$Gestion_moment_5)

afc_Y <- dudi.coa(Y,  scannf = FALSE, nf = p)
acc <- pcaiv(afc_Y, X,  scannf = FALSE, nf = m)

Q <- viz_coaiv(acc,"co") 
viz_coaiv(acc,"li")
viz_coaiv(acc, "li", axes = c(2,3))

Z <-  viz_coaiv(acc, "ls") 
viz_coaiv(acc, "match")
viz_coaiv(acc, "fa") 

E <- viz_coaiv(acc, "cor") 
viz_coaiv(acc, "cor", axes=c(1,3)) 
viz_coaiv(acc, "li", axes = c(1,3))

R <- viz_coaiv(acc, "as") 
viz_coaiv(acc, "as", axes=c(2,3)) 

Z = Z + aes(color = gestion_5) + labs(title = "Position des parcelles", color = "Type de gestion", fill = "Type de gestion", shape = "Type de gestion") +
      scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) 
Q = Q + labs(title = "Position des espèces de plantes")
E= E + labs(title = "Variables explicatives")
R= R + labs(title = "Participations des axes à la dimention 1-2")

(Q + E) / (Z + R)
```






## Modèles linéaires
### LMM 1. G2 - Sélection et simplification des modèles
#### S Plant
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM1_S_Pl <- lmer(S_Plant ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_S_Pl)
# shapiro.test(residuals(LM1_S_Pl))

LM1_S_Pl <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_S_Pl)
# shapiro.test(residuals(LM1_S_Pl))

step(LM1_S_Pl, direction = "backward") # sqrt(S_Plant) ~ Gestion_2 + (1 | Parcelle)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM1_S_Pl)
Anova(LM1_S_Pl)
summary(LM1_S_Pl)
# LM1_S_Pl
eLM1_S_Pl_P<-emmeans(LM1_S_Pl,"Periode")
mcLM1_S_Pl_P<-cld(eLM1_S_Pl_P,ajust="tukey")
mcLM1_S_Pl_P$.group<-as.numeric(mcLM1_S_Pl_P$.group)
mcLM1_S_Pl_P$group[mcLM1_S_Pl_P$.group == 1] <- "a"
mcLM1_S_Pl_P$group[mcLM1_S_Pl_P$.group == 2] <- "b"
mcLM1_S_Pl_P

eLM1_S_Pl_G2<-emmeans(LM1_S_Pl,"Gestion_2")
mcLM1_S_Pl_G2<-cld(eLM1_S_Pl_G2,ajust="tukey")
mcLM1_S_Pl_G2$.group<-as.numeric(mcLM1_S_Pl_G2$.group)
mcLM1_S_Pl_G2$group[mcLM1_S_Pl_G2$.group == 1] <- "a"
mcLM1_S_Pl_G2$group[mcLM1_S_Pl_G2$.group == 2] <- "b"
mcLM1_S_Pl_G2
```

#### Ab Plant
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM1_Ab_Pl <- lmer(Ab_Plant ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_Ab_Pl)
# shapiro.test(residuals(LM1_Ab_Pl))

LM1_Ab_Pl <- lmer(sqrt(Ab_Plant) ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_Ab_Pl)
# shapiro.test(residuals(LM1_Ab_Pl))

step(LM1_Ab_Pl, direction = "backward") # sqrt(Ab_Plant) ~ Temperature + Periode + (1 | Parcelle)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM1_Ab_Pl)
Anova(LM1_Ab_Pl)
# summary(LM1_Ab_Pl)
coef(LM1_Ab_Pl)
# LM1_Ab_Pl
eLM1_Ab_Pl_P<-emmeans(LM1_Ab_Pl,"Periode")
mcLM1_Ab_Pl_P<-cld(eLM1_Ab_Pl_P,ajust="tukey")
mcLM1_Ab_Pl_P$.group<-as.numeric(mcLM1_Ab_Pl_P$.group)
mcLM1_Ab_Pl_P$group[mcLM1_Ab_Pl_P$.group == 1] <- "b"
mcLM1_Ab_Pl_P$group[mcLM1_Ab_Pl_P$.group == 2] <- "a"
mcLM1_Ab_Pl_P

eLM1_Ab_Pl_G2<-emmeans(LM1_Ab_Pl,"Gestion_2")
mcLM1_Ab_Pl_G2<-cld(eLM1_Ab_Pl_G2,ajust="tukey")
mcLM1_Ab_Pl_G2$.group<-as.numeric(mcLM1_Ab_Pl_G2$.group)
mcLM1_Ab_Pl_G2$group[mcLM1_Ab_Pl_G2$.group == 1] <- "a"
mcLM1_Ab_Pl_G2$group[mcLM1_Ab_Pl_G2$.group == 2] <- "b"
mcLM1_Ab_Pl_G2
```


#### S Poll
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM1_S_Po <- lmer(S_Poll ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_S_Po)
# shapiro.test(residuals(LM1_S_Po))

LM1_S_Po <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_S_Po)
# shapiro.test(residuals(LM1_S_Po))

step(LM1_S_Po, direction = "backward") # sqrt(S_Poll) ~ Gestion_2 + (1 | Parcelle)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM1_S_Po)
Anova(LM1_S_Po)
# summary(LM1_S_Po)
# LM1_S_Po
eLM1_S_Po_P<-emmeans(LM1_S_Po,"Periode")
mcLM1_S_Po_P<-cld(eLM1_S_Po_P,ajust="tukey")
mcLM1_S_Po_P$.group<-as.numeric(mcLM1_S_Po_P$.group)
mcLM1_S_Po_P$group[mcLM1_S_Po_P$.group == 1] <- "a"
mcLM1_S_Po_P$group[mcLM1_S_Po_P$.group == 2] <- "b"
mcLM1_S_Po_P

eLM1_S_Po_G2<-emmeans(LM1_S_Po,"Gestion_2")
mcLM1_S_Po_G2<-cld(eLM1_S_Po_G2,ajust="tukey")
mcLM1_S_Po_G2$.group<-as.numeric(mcLM1_S_Po_G2$.group)
mcLM1_S_Po_G2$group[mcLM1_S_Po_G2$.group == 1] <- "a"
mcLM1_S_Po_G2$group[mcLM1_S_Po_G2$.group == 2] <- "b"
mcLM1_S_Po_G2
```

#### Ab Poll
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM1_Ab_Po <- lmer(Ab_Poll ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_Ab_Po)
# shapiro.test(residuals(LM1_Ab_Po))

LM1_Ab_Po <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode * Gestion_2 + (1|Parcelle), data = Inv)
# check_model(LM1_Ab_Po)
# shapiro.test(residuals(LM1_Ab_Po))

step(LM1_Ab_Po, direction = "backward") # sqrt(Ab_Poll) ~ Gestion_2 + (1 | Parcelle)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM1_Ab_Po)
Anova(LM1_Ab_Po)
# summary(LM1_Ab_Po)
# LM1_Ab_Po
eLM1_Ab_Po_P<-emmeans(LM1_Ab_Po,"Periode")
mcLM1_Ab_Po_P<-cld(eLM1_Ab_Po_P,ajust="tukey")
mcLM1_Ab_Po_P$.group<-as.numeric(mcLM1_Ab_Po_P$.group)
mcLM1_Ab_Po_P$group[mcLM1_Ab_Po_P$.group == 1] <- "a"
mcLM1_Ab_Po_P$group[mcLM1_Ab_Po_P$.group == 2] <- "b"
mcLM1_Ab_Po_P

eLM1_Ab_Po_G2<-emmeans(LM1_Ab_Po,"Gestion_2")
mcLM1_Ab_Po_G2<-cld(eLM1_Ab_Po_G2,ajust="tukey")
mcLM1_Ab_Po_G2$.group<-as.numeric(mcLM1_Ab_Po_G2$.group)
mcLM1_Ab_Po_G2$group[mcLM1_Ab_Po_G2$.group == 1] <- "a"
mcLM1_Ab_Po_G2$group[mcLM1_Ab_Po_G2$.group == 2] <- "b"
mcLM1_Ab_Po_G2
```

### LMM 2. G5 - Sélection et simplification des modèles
#### S Plant
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM2_S_Pl <- lmer(S_Plant ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_S_Pl)
# shapiro.test(residuals(LM2_S_Pl))

LM2_S_Pl <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_S_Pl)
# shapiro.test(residuals(LM2_S_Pl))

step(LM2_S_Pl, direction = "backward") # sqrt(S_Plant) ~ Periode + Gestion_moment_5 + (1 | Parcelle)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM2_S_Pl)
Anova(LM2_S_Pl)
# summary(LM2_S_Pl)
# LM2_S_Pl
eLM2_S_Pl_P<-emmeans(LM2_S_Pl,"Periode")
mcLM2_S_Pl_P<-cld(eLM2_S_Pl_P,ajust="tukey")
mcLM2_S_Pl_P$.group<-as.numeric(mcLM2_S_Pl_P$.group)
mcLM2_S_Pl_P$group[mcLM2_S_Pl_P$.group == 1] <- "a"
mcLM2_S_Pl_P$group[mcLM2_S_Pl_P$.group == 2] <- "b"
mcLM2_S_Pl_P


CM2_S_Pl_P_G <- Inv %>% 
  filter(Gestion_moment_5 == "Graminées")
LM2_S_Pl_P_G <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Pl_P_G)
eLM2_S_Pl_P_G<-emmeans(LM2_S_Pl_P_G,"Periode")
mcLM2_S_Pl_P_G<-cld(eLM2_S_Pl_P_G,ajust="tukey")
mcLM2_S_Pl_P_G$.group<-as.numeric(mcLM2_S_Pl_P_G$.group)
mcLM2_S_Pl_P_G$group[mcLM2_S_Pl_P_G$.group == 1] <- "a"
mcLM2_S_Pl_P_G$group[mcLM2_S_Pl_P_G$.group == 2] <- "b"
mcLM2_S_Pl_P_G
CM2_S_Pl_P_F <- Inv %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM2_S_Pl_P_F <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Pl_P_F)
eLM2_S_Pl_P_F<-emmeans(LM2_S_Pl_P_F,"Periode")
mcLM2_S_Pl_P_F<-cld(eLM2_S_Pl_P_F,ajust="tukey")
mcLM2_S_Pl_P_F$.group<-as.numeric(mcLM2_S_Pl_P_F$.group)
mcLM2_S_Pl_P_F$group[mcLM2_S_Pl_P_F$.group == 1] <- "a"
mcLM2_S_Pl_P_F$group[mcLM2_S_Pl_P_F$.group == 2] <- "b"
mcLM2_S_Pl_P_F
CM2_S_Pl_P_S <- Inv %>% 
  filter(Gestion_moment_5 == "Semé")
LM2_S_Pl_P_S <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Pl_P_S)
eLM2_S_Pl_P_S<-emmeans(LM2_S_Pl_P_S,"Periode")
mcLM2_S_Pl_P_S<-cld(eLM2_S_Pl_P_S,ajust="tukey")
mcLM2_S_Pl_P_S$.group<-as.numeric(mcLM2_S_Pl_P_S$.group)
mcLM2_S_Pl_P_S$group[mcLM2_S_Pl_P_S$.group == 1] <- "a"
mcLM2_S_Pl_P_S$group[mcLM2_S_Pl_P_S$.group == 2] <- "b"
mcLM2_S_Pl_P_S
CM2_S_Pl_P_Tr <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM2_S_Pl_P_Tr <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Pl_P_Tr)
eLM2_S_Pl_P_Tr<-emmeans(LM2_S_Pl_P_Tr,"Periode")
mcLM2_S_Pl_P_Tr<-cld(eLM2_S_Pl_P_Tr,ajust="tukey")
mcLM2_S_Pl_P_Tr$.group<-as.numeric(mcLM2_S_Pl_P_Tr$.group)
mcLM2_S_Pl_P_Tr$group[mcLM2_S_Pl_P_Tr$.group == 1] <- "a"
mcLM2_S_Pl_P_Tr$group[mcLM2_S_Pl_P_Tr$.group == 2] <- "b"
mcLM2_S_Pl_P_Tr
CM2_S_Pl_P_Tt <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM2_S_Pl_P_Tt <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Pl_P_Tt)
eLM2_S_Pl_P_Tt<-emmeans(LM2_S_Pl_P_Tt,"Periode")
mcLM2_S_Pl_P_Tt<-cld(eLM2_S_Pl_P_Tt,ajust="tukey")
mcLM2_S_Pl_P_Tt$.group<-as.numeric(mcLM2_S_Pl_P_Tt$.group)
mcLM2_S_Pl_P_Tt$group[mcLM2_S_Pl_P_Tt$.group == 1] <- "a"
mcLM2_S_Pl_P_Tt$group[mcLM2_S_Pl_P_Tt$.group == 2] <- "b"
mcLM2_S_Pl_P_Tt

eLM2_S_Pl_G5<-emmeans(LM2_S_Pl,"Gestion_moment_5")
mcLM2_S_Pl_G5<-cld(eLM2_S_Pl_G5,ajust="tukey")
mcLM2_S_Pl_G5$.group<-as.numeric(mcLM2_S_Pl_G5$.group)
mcLM2_S_Pl_G5$group[mcLM2_S_Pl_G5$.group == 1] <- "a"
mcLM2_S_Pl_G5$group[mcLM2_S_Pl_G5$.group == 2] <- "b"
mcLM2_S_Pl_G5$group[mcLM2_S_Pl_G5$.group == 3] <- "c"
mcLM2_S_Pl_G5$group[mcLM2_S_Pl_G5$.group == 23] <- "bc"
mcLM2_S_Pl_G5
```

#### Ab Plant
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM2_Ab_Pl <- lmer(Ab_Plant ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_Ab_Pl)
# shapiro.test(residuals(LM2_Ab_Pl))

LM2_Ab_Pl <- lmer(sqrt(Ab_Plant) ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_Ab_Pl)
# shapiro.test(residuals(LM2_Ab_Pl))

step(LM2_Ab_Pl, direction = "backward") # sqrt(Ab_Plant) ~ Temperature + Periode + Gestion_moment_5 + (1 | Parcelle)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM2_Ab_Pl)
Anova(LM2_Ab_Pl)
# summary(LM2_Ab_Pl)
# LM2_Ab_Pl
eLM2_Ab_Pl_P<-emmeans(LM2_Ab_Pl,"Periode")
mcLM2_Ab_Pl_P<-cld(eLM2_Ab_Pl_P,ajust="tukey")
mcLM2_Ab_Pl_P$.group<-as.numeric(mcLM2_Ab_Pl_P$.group)
mcLM2_Ab_Pl_P$group[mcLM2_Ab_Pl_P$.group == 1] <- "b"
mcLM2_Ab_Pl_P$group[mcLM2_Ab_Pl_P$.group == 2] <- "a"
mcLM2_Ab_Pl_P

CM2_Ab_Pl_P_G <- Inv %>% 
  filter(Gestion_moment_5 == "Graminées")
LM2_Ab_Pl_P_G <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_Ab_Pl_P_G)
eLM2_Ab_Pl_P_G<-emmeans(LM2_Ab_Pl_P_G,"Periode")
mcLM2_Ab_Pl_P_G<-cld(eLM2_Ab_Pl_P_G,ajust="tukey")
mcLM2_Ab_Pl_P_G$.group<-as.numeric(mcLM2_Ab_Pl_P_G$.group)
mcLM2_Ab_Pl_P_G$group[mcLM2_Ab_Pl_P_G$.group == 1] <- "a"
mcLM2_Ab_Pl_P_G$group[mcLM2_Ab_Pl_P_G$.group == 2] <- "b"
mcLM2_Ab_Pl_P_G
CM2_Ab_Pl_P_F <- Inv %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM2_Ab_Pl_P_F <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_Ab_Pl_P_F)
eLM2_Ab_Pl_P_F<-emmeans(LM2_Ab_Pl_P_F,"Periode")
mcLM2_Ab_Pl_P_F<-cld(eLM2_Ab_Pl_P_F,ajust="tukey")
mcLM2_Ab_Pl_P_F$.group<-as.numeric(mcLM2_Ab_Pl_P_F$.group)
mcLM2_Ab_Pl_P_F$group[mcLM2_Ab_Pl_P_F$.group == 1] <- "a"
mcLM2_Ab_Pl_P_F$group[mcLM2_Ab_Pl_P_F$.group == 2] <- "b"
mcLM2_Ab_Pl_P_F
CM2_Ab_Pl_P_S <- Inv %>% 
  filter(Gestion_moment_5 == "Semé")
LM2_Ab_Pl_P_S <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_Ab_Pl_P_S)
eLM2_Ab_Pl_P_S<-emmeans(LM2_Ab_Pl_P_S,"Periode")
mcLM2_Ab_Pl_P_S<-cld(eLM2_Ab_Pl_P_S,ajust="tukey")
mcLM2_Ab_Pl_P_S$.group<-as.numeric(mcLM2_Ab_Pl_P_S$.group)
mcLM2_Ab_Pl_P_S$group[mcLM2_Ab_Pl_P_S$.group == 1] <- "a"
mcLM2_Ab_Pl_P_S$group[mcLM2_Ab_Pl_P_S$.group == 2] <- "b"
mcLM2_Ab_Pl_P_S
CM2_Ab_Pl_P_Tr <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM2_Ab_Pl_P_Tr <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_Ab_Pl_P_Tr)
eLM2_Ab_Pl_P_Tr<-emmeans(LM2_Ab_Pl_P_Tr,"Periode")
mcLM2_Ab_Pl_P_Tr<-cld(eLM2_Ab_Pl_P_Tr,ajust="tukey")
mcLM2_Ab_Pl_P_Tr$.group<-as.numeric(mcLM2_Ab_Pl_P_Tr$.group)
mcLM2_Ab_Pl_P_Tr$group[mcLM2_Ab_Pl_P_Tr$.group == 1] <- "a"
mcLM2_Ab_Pl_P_Tr$group[mcLM2_Ab_Pl_P_Tr$.group == 2] <- "b"
mcLM2_Ab_Pl_P_Tr
CM2_Ab_Pl_P_Tt <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM2_Ab_Pl_P_Tt <- lmer(sqrt(S_Plant) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_Ab_Pl_P_Tt)
eLM2_Ab_Pl_P_Tt<-emmeans(LM2_Ab_Pl_P_Tt,"Periode")
mcLM2_Ab_Pl_P_Tt<-cld(eLM2_Ab_Pl_P_Tt,ajust="tukey")
mcLM2_Ab_Pl_P_Tt$.group<-as.numeric(mcLM2_Ab_Pl_P_Tt$.group)
mcLM2_Ab_Pl_P_Tt$group[mcLM2_Ab_Pl_P_Tt$.group == 1] <- "a"
mcLM2_Ab_Pl_P_Tt$group[mcLM2_Ab_Pl_P_Tt$.group == 2] <- "b"
mcLM2_Ab_Pl_P_Tt

eLM2_Ab_Pl_G5<-emmeans(LM2_Ab_Pl,"Gestion_moment_5")
mcLM2_Ab_Pl_G5<-cld(eLM2_Ab_Pl_G5,ajust="tukey")
mcLM2_Ab_Pl_G5$.group<-as.numeric(mcLM2_Ab_Pl_G5$.group)
mcLM2_Ab_Pl_G5$group[mcLM2_Ab_Pl_G5$.group == 1] <- "a"
mcLM2_Ab_Pl_G5$group[mcLM2_Ab_Pl_G5$.group == 2] <- "b"
mcLM2_Ab_Pl_G5$group[mcLM2_Ab_Pl_G5$.group == 3] <- "c"
mcLM2_Ab_Pl_G5$group[mcLM2_Ab_Pl_G5$.group == 23] <- "bc"
mcLM2_Ab_Pl_G5
```

#### S Poll
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM2_S_Po <- lmer(S_Poll ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_S_Po)
# shapiro.test(residuals(LM2_S_Po))

LM2_S_Po <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_S_Po)
# shapiro.test(residuals(LM2_S_Po))

step(LM2_S_Po, direction = "backward") 
# sqrt(S_Poll) ~ Periode + Gestion_moment_5 + (1 | Parcelle) + Periode:Gestion_moment_5
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM2_S_Po)
Anova(LM2_S_Po)
# summary(LM2_S_Po)
# LM2_S_Po
eLM2_S_Po_P<-emmeans(LM2_S_Po,"Periode")
mcLM2_S_Po_P<-cld(eLM2_S_Po_P,ajust="tukey")
mcLM2_S_Po_P$.group<-as.numeric(mcLM2_S_Po_P$.group)
mcLM2_S_Po_P$group[mcLM2_S_Po_P$.group == 1] <- "a"
mcLM2_S_Po_P$group[mcLM2_S_Po_P$.group == 2] <- "b"
mcLM2_S_Po_P

CM2_S_Po_P_G <- Inv %>% 
  filter(Gestion_moment_5 == "Graminées")
LM2_S_Po_P_G <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Po_P_G)
eLM2_S_Po_P_G<-emmeans(LM2_S_Po_P_G,"Periode")
mcLM2_S_Po_P_G<-cld(eLM2_S_Po_P_G,ajust="tukey")
mcLM2_S_Po_P_G$.group<-as.numeric(mcLM2_S_Po_P_G$.group)
mcLM2_S_Po_P_G$group[mcLM2_S_Po_P_G$.group == 1] <- "a"
mcLM2_S_Po_P_G$group[mcLM2_S_Po_P_G$.group == 2] <- "b"
mcLM2_S_Po_P_G
CM2_S_Po_P_F <- Inv %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM2_S_Po_P_F <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Po_P_F)
eLM2_S_Po_P_F<-emmeans(LM2_S_Po_P_F,"Periode")
mcLM2_S_Po_P_F<-cld(eLM2_S_Po_P_F,ajust="tukey")
mcLM2_S_Po_P_F$.group<-as.numeric(mcLM2_S_Po_P_F$.group)
mcLM2_S_Po_P_F$group[mcLM2_S_Po_P_F$.group == 1] <- "a"
mcLM2_S_Po_P_F$group[mcLM2_S_Po_P_F$.group == 2] <- "b"
mcLM2_S_Po_P_F
CM2_S_Po_P_S <- Inv %>% 
  filter(Gestion_moment_5 == "Semé")
LM2_S_Po_P_S <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Po_P_S)
eLM2_S_Po_P_S<-emmeans(LM2_S_Po_P_S,"Periode")
mcLM2_S_Po_P_S<-cld(eLM2_S_Po_P_S,ajust="tukey")
mcLM2_S_Po_P_S$.group<-as.numeric(mcLM2_S_Po_P_S$.group)
mcLM2_S_Po_P_S$group[mcLM2_S_Po_P_S$.group == 1] <- "a"
mcLM2_S_Po_P_S$group[mcLM2_S_Po_P_S$.group == 2] <- "b"
mcLM2_S_Po_P_S$group[mcLM2_S_Po_P_S$.group == 12] <- "ab"
mcLM2_S_Po_P_S
CM2_S_Po_P_Tr <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM2_S_Po_P_Tr <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Po_P_Tr)
eLM2_S_Po_P_Tr<-emmeans(LM2_S_Po_P_Tr,"Periode")
mcLM2_S_Po_P_Tr<-cld(eLM2_S_Po_P_Tr,ajust="tukey")
mcLM2_S_Po_P_Tr$.group<-as.numeric(mcLM2_S_Po_P_Tr$.group)
mcLM2_S_Po_P_Tr$group[mcLM2_S_Po_P_Tr$.group == 1] <- "a"
mcLM2_S_Po_P_Tr$group[mcLM2_S_Po_P_Tr$.group == 2] <- "b"
mcLM2_S_Po_P_Tr
CM2_S_Po_P_Tt <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM2_S_Po_P_Tt <- lmer(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Po_P_Tt)
eLM2_S_Po_P_Tt<-emmeans(LM2_S_Po_P_Tt,"Periode")
mcLM2_S_Po_P_Tt<-cld(eLM2_S_Po_P_Tt,ajust="tukey")
mcLM2_S_Po_P_Tt$.group<-as.numeric(mcLM2_S_Po_P_Tt$.group)
mcLM2_S_Po_P_Tt$group[mcLM2_S_Po_P_Tt$.group == 1] <- "a"
mcLM2_S_Po_P_Tt$group[mcLM2_S_Po_P_Tt$.group == 2] <- "b"
mcLM2_S_Po_P_Tt$group[mcLM2_S_Po_P_Tt$.group == 12] <- "ab"
mcLM2_S_Po_P_Tt



eLM2_S_Po_G5<-emmeans(LM2_S_Po,"Gestion_moment_5")
mcLM2_S_Po_G5<-cld(eLM2_S_Po_G5,ajust="tukey")
mcLM2_S_Po_G5$.group<-as.numeric(mcLM2_S_Po_G5$.group)
mcLM2_S_Po_G5$group[mcLM2_S_Po_G5$.group == 1] <- "a"
mcLM2_S_Po_G5$group[mcLM2_S_Po_G5$.group == 2] <- "b"
mcLM2_S_Po_G5$group[mcLM2_S_Po_G5$.group == 3] <- "c"
mcLM2_S_Po_G5$group[mcLM2_S_Po_G5$.group == 12] <- "ab"
mcLM2_S_Po_G5


CM2_S_Po_G5_Ju <- Inv %>% 
  filter(Periode == "Juin")
LM2_S_Po_G5_Ju <- lm(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM2_S_Po_G5_Ju)
eLM2_S_Po_G5_Ju<-emmeans(LM2_S_Po_G5_Ju,"Gestion_moment_5")
mcLM2_S_Po_G5_Ju<-cld(eLM2_S_Po_G5_Ju,ajust="tukey")
mcLM2_S_Po_G5_Ju$.group<-as.numeric(mcLM2_S_Po_G5_Ju$.group)
mcLM2_S_Po_G5_Ju$group[mcLM2_S_Po_G5_Ju$.group == 1] <- "a"
mcLM2_S_Po_G5_Ju$group[mcLM2_S_Po_G5_Ju$.group == 2] <- "b"
mcLM2_S_Po_G5_Ju
CM2_S_Po_G5_mJ <- Inv %>% 
  filter(Periode == "Mi-juillet")
LM2_S_Po_G5_mJ <- lm(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM2_S_Po_G5_mJ)
eLM2_S_Po_G5_mJ<-emmeans(LM2_S_Po_G5_mJ,"Gestion_moment_5")
mcLM2_S_Po_G5_mJ<-cld(eLM2_S_Po_G5_mJ,ajust="tukey")
mcLM2_S_Po_G5_mJ$.group<-as.numeric(mcLM2_S_Po_G5_mJ$.group)
mcLM2_S_Po_G5_mJ$group[mcLM2_S_Po_G5_mJ$.group == 1] <- "a"
mcLM2_S_Po_G5_mJ$group[mcLM2_S_Po_G5_mJ$.group == 12] <- "ab"
mcLM2_S_Po_G5_mJ$group[mcLM2_S_Po_G5_mJ$.group == 23] <- "bc"
mcLM2_S_Po_G5_mJ$group[mcLM2_S_Po_G5_mJ$.group == 34] <- "cd"
mcLM2_S_Po_G5_mJ$group[mcLM2_S_Po_G5_mJ$.group == 4] <- "d"
mcLM2_S_Po_G5_mJ
CM2_S_Po_G5_fJ <- Inv %>% 
  filter(Periode == "Fin juillet")
LM2_S_Po_G5_fJ <- lm(sqrt(S_Poll) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM2_S_Po_G5_fJ)
eLM2_S_Po_G5_fJ<-emmeans(LM2_S_Po_G5_fJ,"Gestion_moment_5")
mcLM2_S_Po_G5_fJ<-cld(eLM2_S_Po_G5_fJ,ajust="tukey")
mcLM2_S_Po_G5_fJ$.group<-as.numeric(mcLM2_S_Po_G5_fJ$.group)
mcLM2_S_Po_G5_fJ$group[mcLM2_S_Po_G5_fJ$.group == 1] <- "a"
mcLM2_S_Po_G5_fJ$group[mcLM2_S_Po_G5_fJ$.group == 2] <- "b"
mcLM2_S_Po_G5_fJ$group[mcLM2_S_Po_G5_fJ$.group == 12] <- "ab"
mcLM2_S_Po_G5_fJ
```

#### Ab Poll
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM2_Ab_Po <- lmer(Ab_Poll ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_Ab_Po)
# shapiro.test(residuals(LM2_Ab_Po))

LM2_Ab_Po <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Inv)
# check_model(LM2_Ab_Po)
# shapiro.test(residuals(LM2_Ab_Po))

step(LM2_Ab_Po, direction = "backward") # sqrt(Ab_Poll) ~ Periode + Gestion_moment_5 + (1 | Parcelle) + Periode:Gestion_moment_5
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM2_Ab_Po)
Anova(LM2_Ab_Po)
# summary(LM2_Ab_Po)
# LM2_Ab_Po
eLM2_Ab_Po_P<-emmeans(LM2_Ab_Po,"Periode")
mcLM2_Ab_Po_P<-cld(eLM2_Ab_Po_P,ajust="tukey")
mcLM2_Ab_Po_P$.group<-as.numeric(mcLM2_Ab_Po_P$.group)
mcLM2_Ab_Po_P$group[mcLM2_Ab_Po_P$.group == 1] <- "a"
mcLM2_Ab_Po_P$group[mcLM2_Ab_Po_P$.group == 2] <- "b"
mcLM2_Ab_Po_P

CM2_S_Ab_P_G <- Inv %>% 
  filter(Gestion_moment_5 == "Graminées")
LM2_S_Ab_P_G <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Ab_P_G)
eLM2_S_Ab_P_G<-emmeans(LM2_S_Ab_P_G,"Periode")
mcLM2_S_Ab_P_G<-cld(eLM2_S_Ab_P_G,ajust="tukey")
mcLM2_S_Ab_P_G$.group<-as.numeric(mcLM2_S_Ab_P_G$.group)
mcLM2_S_Ab_P_G$group[mcLM2_S_Ab_P_G$.group == 1] <- "a"
mcLM2_S_Ab_P_G$group[mcLM2_S_Ab_P_G$.group == 2] <- "b"
mcLM2_S_Ab_P_G
CM2_S_Ab_P_F <- Inv %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM2_S_Ab_P_F <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Ab_P_F)
eLM2_S_Ab_P_F<-emmeans(LM2_S_Ab_P_F,"Periode")
mcLM2_S_Ab_P_F<-cld(eLM2_S_Ab_P_F,ajust="tukey")
mcLM2_S_Ab_P_F$.group<-as.numeric(mcLM2_S_Ab_P_F$.group)
mcLM2_S_Ab_P_F$group[mcLM2_S_Ab_P_F$.group == 1] <- "a"
mcLM2_S_Ab_P_F$group[mcLM2_S_Ab_P_F$.group == 2] <- "b"
mcLM2_S_Ab_P_F
CM2_S_Ab_P_S <- Inv %>% 
  filter(Gestion_moment_5 == "Semé")
LM2_S_Ab_P_S <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Ab_P_S)
eLM2_S_Ab_P_S<-emmeans(LM2_S_Ab_P_S,"Periode")
mcLM2_S_Ab_P_S<-cld(eLM2_S_Ab_P_S,ajust="tukey")
mcLM2_S_Ab_P_S$.group<-as.numeric(mcLM2_S_Ab_P_S$.group)
mcLM2_S_Ab_P_S$group[mcLM2_S_Ab_P_S$.group == 1] <- "a"
mcLM2_S_Ab_P_S$group[mcLM2_S_Ab_P_S$.group == 2] <- "b"
mcLM2_S_Ab_P_S$group[mcLM2_S_Ab_P_S$.group == 12] <- "ab"
mcLM2_S_Ab_P_S
CM2_S_Ab_P_Tr <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM2_S_Ab_P_Tr <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Ab_P_Tr)
eLM2_S_Ab_P_Tr<-emmeans(LM2_S_Ab_P_Tr,"Periode")
mcLM2_S_Ab_P_Tr<-cld(eLM2_S_Ab_P_Tr,ajust="tukey")
mcLM2_S_Ab_P_Tr$.group<-as.numeric(mcLM2_S_Ab_P_Tr$.group)
mcLM2_S_Ab_P_Tr$group[mcLM2_S_Ab_P_Tr$.group == 1] <- "a"
mcLM2_S_Ab_P_Tr$group[mcLM2_S_Ab_P_Tr$.group == 2] <- "b"
mcLM2_S_Ab_P_Tr
CM2_S_Ab_P_Tt <- Inv %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM2_S_Ab_P_Tt <- lmer(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM2_S_Ab_P_Tt)
eLM2_S_Ab_P_Tt<-emmeans(LM2_S_Ab_P_Tt,"Periode")
mcLM2_S_Ab_P_Tt<-cld(eLM2_S_Ab_P_Tt,ajust="tukey")
mcLM2_S_Ab_P_Tt$.group<-as.numeric(mcLM2_S_Ab_P_Tt$.group)
mcLM2_S_Ab_P_Tt$group[mcLM2_S_Ab_P_Tt$.group == 1] <- "a"
mcLM2_S_Ab_P_Tt$group[mcLM2_S_Ab_P_Tt$.group == 2] <- "b"
mcLM2_S_Ab_P_Tt$group[mcLM2_S_Ab_P_Tt$.group == 12] <- "ab"
mcLM2_S_Ab_P_Tt



eLM2_Ab_Po_G5<-emmeans(LM2_Ab_Po,"Gestion_moment_5")
mcLM2_Ab_Po_G5<-cld(eLM2_Ab_Po_G5,ajust="tukey")
mcLM2_Ab_Po_G5$.group<-as.numeric(mcLM2_Ab_Po_G5$.group)
mcLM2_Ab_Po_G5$group[mcLM2_Ab_Po_G5$.group == 1] <- "a"
mcLM2_Ab_Po_G5$group[mcLM2_Ab_Po_G5$.group == 2] <- "b"
mcLM2_Ab_Po_G5$group[mcLM2_Ab_Po_G5$.group == 3] <- "c"
mcLM2_Ab_Po_G5$group[mcLM2_Ab_Po_G5$.group == 12] <- "ab"
mcLM2_Ab_Po_G5$group[mcLM2_Ab_Po_G5$.group == 4] <- "d"
mcLM2_Ab_Po_G5


CM2_Ab_Po_G5_Ju <- Inv %>% 
  filter(Periode == "Juin")
LM2_Ab_Po_G5_Ju <- lm(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM2_Ab_Po_G5_Ju)
eLM2_Ab_Po_G5_Ju<-emmeans(LM2_Ab_Po_G5_Ju,"Gestion_moment_5")
mcLM2_Ab_Po_G5_Ju<-cld(eLM2_Ab_Po_G5_Ju,ajust="tukey")
mcLM2_Ab_Po_G5_Ju$.group<-as.numeric(mcLM2_Ab_Po_G5_Ju$.group)
mcLM2_Ab_Po_G5_Ju$group[mcLM2_Ab_Po_G5_Ju$.group == 1] <- "a"
mcLM2_Ab_Po_G5_Ju$group[mcLM2_Ab_Po_G5_Ju$.group == 2] <- "b"
mcLM2_Ab_Po_G5_Ju$group[mcLM2_Ab_Po_G5_Ju$.group == 12] <- "ab"
mcLM2_Ab_Po_G5_Ju$group[mcLM2_Ab_Po_G5_Ju$.group == 3] <- "c"
mcLM2_Ab_Po_G5_Ju
CM2_Ab_Po_G5_mJ <- Inv %>% 
  filter(Periode == "Mi-juillet")
LM2_Ab_Po_G5_mJ <- lm(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM2_Ab_Po_G5_mJ)
eLM2_Ab_Po_G5_mJ<-emmeans(LM2_Ab_Po_G5_mJ,"Gestion_moment_5")
mcLM2_Ab_Po_G5_mJ<-cld(eLM2_Ab_Po_G5_mJ,ajust="tukey")
mcLM2_Ab_Po_G5_mJ$.group<-as.numeric(mcLM2_Ab_Po_G5_mJ$.group)
mcLM2_Ab_Po_G5_mJ$group[mcLM2_Ab_Po_G5_mJ$.group == 1] <- "a"
mcLM2_Ab_Po_G5_mJ$group[mcLM2_Ab_Po_G5_mJ$.group == 12] <- "ab"
mcLM2_Ab_Po_G5_mJ$group[mcLM2_Ab_Po_G5_mJ$.group == 23] <- "bc"
mcLM2_Ab_Po_G5_mJ$group[mcLM2_Ab_Po_G5_mJ$.group == 3] <- "c"
mcLM2_Ab_Po_G5_mJ$group[mcLM2_Ab_Po_G5_mJ$.group == 4] <- "d"
mcLM2_Ab_Po_G5_mJ
CM2_Ab_Po_G5_fJ <- Inv %>% 
  filter(Periode == "Fin juillet")
LM2_Ab_Po_G5_fJ <- lm(sqrt(Ab_Poll) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM2_Ab_Po_G5_fJ)
eLM2_Ab_Po_G5_fJ<-emmeans(LM2_Ab_Po_G5_fJ,"Gestion_moment_5")
mcLM2_Ab_Po_G5_fJ<-cld(eLM2_Ab_Po_G5_fJ,ajust="tukey")
mcLM2_Ab_Po_G5_fJ$.group<-as.numeric(mcLM2_Ab_Po_G5_fJ$.group)
mcLM2_Ab_Po_G5_fJ$group[mcLM2_Ab_Po_G5_fJ$.group == 1] <- "a"
mcLM2_Ab_Po_G5_fJ$group[mcLM2_Ab_Po_G5_fJ$.group == 2] <- "b"
mcLM2_Ab_Po_G5_fJ$group[mcLM2_Ab_Po_G5_fJ$.group == 12] <- "ab"
mcLM2_Ab_Po_G5_fJ
```

### LMM 3. - N_interactions &  Probabilité de visite selon la quantité de fleurs
proba d'être visité: +/- fct de la densité: N_int ~ qtté_plantes (par sp. de fleurs)
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM3_qtte <- lmer(N_Interactions ~ Qtte_Plantes + Gestion_moment_5 + Qtte_Plantes:Gestion_moment_5 + Area_gis_m_sq + Temperature + Periode + Periode:Gestion_moment_5 + (1|Parcelle), data = Interactions_Gestion)
# check_model(LM3_qtte)
# shapiro.test(residuals(LM3_qtte))

LM3_qtte <- lmer(sqrt(N_Interactions) ~ Qtte_Plantes + Gestion_moment_5 + Qtte_Plantes:Gestion_moment_5 + Area_gis_m_sq + Temperature + Periode + Periode:Gestion_moment_5 + (1|Parcelle), data = Interactions_Gestion)
# check_model(LM3_qtte)
# shapiro.test(residuals(LM3_qtte))

step(LM3_qtte, direction = "backward")
# sqrt(N_Interactions) ~ Qtte_Plantes + Gestion_moment_5 + Temperature + Periode + (1 | Parcelle) + Qtte_Plantes:Gestion_moment_5 + Gestion_moment_5:Periode
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM3_qtte)
Anova(LM3_qtte)
#summary(LM3_qtte)
#LM3_qtte

eLM3_qtte_P<-emmeans(LM3_qtte,"Periode")
mcLM3_qtte_P<-cld(eLM3_qtte_P,ajust="tukey")
mcLM3_qtte_P$.group<-as.numeric(mcLM3_qtte_P$.group)
mcLM3_qtte_P$group[mcLM3_qtte_P$.group == 1] <- "a"
mcLM3_qtte_P$group[mcLM3_qtte_P$.group == 2] <- "b"
mcLM3_qtte_P

eLM3_qtte_G5<-emmeans(LM3_qtte,"Gestion_moment_5")
mcLM3_qtte_G5<-cld(eLM3_qtte_G5,ajust="tukey")
mcLM3_qtte_G5$.group<-as.numeric(mcLM3_qtte_G5$.group)
mcLM3_qtte_G5$group[mcLM3_qtte_G5$.group == 1] <- "a"
mcLM3_qtte_G5$group[mcLM3_qtte_G5$.group == 2] <- "b"
mcLM3_qtte_G5$group[mcLM3_qtte_G5$.group == 3] <- "c"
mcLM3_qtte_G5$group[mcLM3_qtte_G5$.group == 12] <- "ab"
mcLM3_qtte_G5$group[mcLM3_qtte_G5$.group == 4] <- "d"
mcLM3_qtte_G5

CM3_P_G <- Interactions_Gestion %>% 
  filter(Gestion_moment_5 == "Graminées")
LM3_P_G <- lmer(sqrt(N_Interactions) ~ Qtte_Plantes + Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM3_P_G)
eLM3_P_G<-emmeans(LM3_P_G,"Periode")
mcLM3_P_G<-cld(eLM3_P_G,ajust="tukey")
mcLM3_P_G$.group<-as.numeric(mcLM3_P_G$.group)
mcLM3_P_G$group[mcLM3_P_G$.group == 1] <- "a"
mcLM3_P_G$group[mcLM3_P_G$.group == 2] <- "b"
mcLM3_P_G$group[mcLM3_P_G$.group == 12] <- "ab"
mcLM3_P_G
CM3_P_F <- Interactions_Gestion %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM3_P_F <- lmer(sqrt(N_Interactions) ~ Qtte_Plantes + Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM3_P_F)
eLM3_P_F<-emmeans(LM3_P_F,"Periode")
mcLM3_P_F<-cld(eLM3_P_F,ajust="tukey")
mcLM3_P_F$.group<-as.numeric(mcLM3_P_F$.group)
mcLM3_P_F$group[mcLM3_P_F$.group == 1] <- "a"
mcLM3_P_F$group[mcLM3_P_F$.group == 2] <- "b"
mcLM3_P_F$group[mcLM3_P_F$.group == 12] <- "ab"
mcLM3_P_F
CM3_P_S <- Interactions_Gestion %>% 
  filter(Gestion_moment_5 == "Semé")
LM3_P_S <- lmer(sqrt(N_Interactions) ~ Qtte_Plantes +  Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM3_P_S)
eLM3_P_S<-emmeans(LM3_P_S,"Periode")
mcLM3_P_S<-cld(eLM3_P_S,ajust="tukey")
mcLM3_P_S$.group<-as.numeric(mcLM3_P_S$.group)
mcLM3_P_S$group[mcLM3_P_S$.group == 1] <- "a"
mcLM3_P_S
CM3_P_Tr <- Interactions_Gestion %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM3_P_Tr <- lmer(sqrt(N_Interactions) ~  Qtte_Plantes + Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM3_P_Tr)
eLM3_P_Tr<-emmeans(LM3_P_Tr,"Periode")
mcLM3_P_Tr<-cld(eLM3_P_Tr,ajust="tukey")
mcLM3_P_Tr$.group<-as.numeric(mcLM3_P_Tr$.group)
mcLM3_P_Tr$group[mcLM3_P_Tr$.group == 1] <- "a"
mcLM3_P_Tr
CM3_P_Tt <- Interactions_Gestion %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM3_P_Tt <- lmer(sqrt(N_Interactions) ~  Qtte_Plantes + Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM3_P_Tt)
eLM3_P_Tt<-emmeans(LM3_P_Tt,"Periode")
mcLM3_P_Tt<-cld(eLM3_P_Tt,ajust="tukey")
mcLM3_P_Tt$.group<-as.numeric(mcLM3_P_Tt$.group)
mcLM3_P_Tt$group[mcLM3_P_Tt$.group == 1] <- "a"
mcLM3_P_Tt$group[mcLM3_P_Tt$.group == 2] <- "b"
mcLM3_P_Tt$group[mcLM3_P_Tt$.group == 12] <- "ab"
mcLM3_P_Tt


CM3_G5_Ju <- Interactions_Gestion %>% 
  filter(Periode == "Juin")
LM3_G5_Ju <- lmer(sqrt(N_Interactions) ~  Qtte_Plantes + Area_gis_m_sq + Temperature + Gestion_moment_5 + (1|Parcelle), data = CM3_G5_Ju)
eLM3_G5_Ju<-emmeans(LM3_G5_Ju,"Gestion_moment_5")
mcLM3_G5_Ju<-cld(eLM3_G5_Ju,ajust="tukey")
mcLM3_G5_Ju$.group<-as.numeric(mcLM3_G5_Ju$.group)
mcLM3_G5_Ju$group[mcLM3_G5_Ju$.group == 1] <- "a"
mcLM3_G5_Ju$group[mcLM3_G5_Ju$.group == 2] <- "b"
mcLM3_G5_Ju
CM3_G5_mJ <- Interactions_Gestion %>% 
  filter(Periode == "Mi-juillet")
LM3_G5_mJ <-  lmer(sqrt(N_Interactions) ~  Qtte_Plantes + Area_gis_m_sq + Temperature + Gestion_moment_5 + (1|Parcelle), data = CM3_G5_mJ)
eLM3_G5_mJ<-emmeans(LM3_G5_mJ,"Gestion_moment_5")
mcLM3_G5_mJ<-cld(eLM3_G5_mJ,ajust="tukey")
mcLM3_G5_mJ$.group<-as.numeric(mcLM3_G5_mJ$.group)
mcLM3_G5_mJ$group[mcLM3_G5_mJ$.group == 1] <- "a"
mcLM3_G5_mJ$group[mcLM3_G5_mJ$.group == 2] <- "b"
mcLM3_G5_mJ$group[mcLM3_G5_mJ$.group == 3] <- "c"
mcLM3_G5_mJ
CM3_G5_fJ <- Interactions_Gestion %>% 
  filter(Periode == "Fin juillet")
LM3_G5_fJ <-  lmer(sqrt(N_Interactions) ~  Qtte_Plantes + Area_gis_m_sq + Temperature + Gestion_moment_5 + (1|Parcelle), data = CM3_G5_fJ)
eLM3_G5_fJ<-emmeans(LM3_G5_fJ,"Gestion_moment_5")
mcLM3_G5_fJ<-cld(eLM3_G5_fJ,ajust="tukey")
mcLM3_G5_fJ$.group<-as.numeric(mcLM3_G5_fJ$.group)
mcLM3_G5_fJ$group[mcLM3_G5_fJ$.group == 1] <- "a"
mcLM3_G5_fJ$group[mcLM3_G5_fJ$.group == 2] <- "b"
mcLM3_G5_fJ$group[mcLM3_G5_fJ$.group == 12] <- "ab"
mcLM3_G5_fJ
```

### LMM 4. - Sum(N_interactions)
```{r, results = 'hide', warning=FALSE, message=FALSE}
Int_glm <- Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5, Area_gis_m_sq, Temperature, Parcelle) %>% 
  summarize(n= sum(N_Interactions))

LM4_Int <- lmer(n ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Int_glm)
# check_model(LM4_Int)
# shapiro.test(residuals(LM4_Int))

LM4_Int <- lmer(sqrt(n) ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + (1|Parcelle), data = Int_glm)
# check_model(LM4_Int)
# shapiro.test(residuals(LM4_Int))

step(LM4_Int, direction = "backward")
# sqrt(n) ~ Temperature + Periode + Gestion_moment_5 + (1 | Parcelle) + Periode:Gestion_moment_5
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM4_Int)
Anova(LM4_Int)
#summary(LM4_Int)
#LM4_Int

eLM4_Int_P<-emmeans(LM4_Int,"Periode")
mcLM4_Int_P<-cld(eLM4_Int_P,ajust="tukey")
mcLM4_Int_P$.group<-as.numeric(mcLM4_Int_P$.group)
mcLM4_Int_P$group[mcLM4_Int_P$.group == 1] <- "a"
mcLM4_Int_P$group[mcLM4_Int_P$.group == 2] <- "b"
mcLM4_Int_P

CM4_P_G <- Int_glm %>% 
  filter(Gestion_moment_5 == "Graminées")
LM4_P_G <- lmer(sqrt(n) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM4_P_G)
eLM4_P_G<-emmeans(LM4_P_G,"Periode")
mcLM4_P_G<-cld(eLM4_P_G,ajust="tukey")
mcLM4_P_G$.group<-as.numeric(mcLM4_P_G$.group)
mcLM4_P_G$group[mcLM4_P_G$.group == 1] <- "a"
mcLM4_P_G$group[mcLM4_P_G$.group == 2] <- "b"
mcLM4_P_G
CM4_P_F <- Int_glm %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM4_P_F <- lmer(sqrt(n) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM4_P_F)
eLM4_P_F<-emmeans(LM4_P_F,"Periode")
mcLM4_P_F<-cld(eLM4_P_F,ajust="tukey")
mcLM4_P_F$.group<-as.numeric(mcLM4_P_F$.group)
mcLM4_P_F$group[mcLM4_P_F$.group == 1] <- "a"
mcLM4_P_F$group[mcLM4_P_F$.group == 2] <- "b"
mcLM4_P_F$group[mcLM4_P_F$.group == 12] <- "ab"
mcLM4_P_F
CM4_P_S <- Int_glm %>% 
  filter(Gestion_moment_5 == "Semé")
LM4_P_S <- lmer(sqrt(n) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM4_P_S)
eLM4_P_S<-emmeans(LM4_P_S,"Periode")
mcLM4_P_S<-cld(eLM4_P_S,ajust="tukey")
mcLM4_P_S$.group<-as.numeric(mcLM4_P_S$.group)
mcLM4_P_S$group[mcLM4_P_S$.group == 1] <- "a"
mcLM4_P_S$group[mcLM4_P_S$.group == 2] <- "b"
mcLM4_P_S$group[mcLM4_P_S$.group == 12] <- "ab"
mcLM4_P_S
CM4_P_Tr <- Int_glm %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM4_P_Tr <- lmer(sqrt(n) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM4_P_Tr)
eLM4_P_Tr<-emmeans(LM4_P_Tr,"Periode")
mcLM4_P_Tr<-cld(eLM4_P_Tr,ajust="tukey")
mcLM4_P_Tr$.group<-as.numeric(mcLM4_P_Tr$.group)
mcLM4_P_Tr$group[mcLM4_P_Tr$.group == 1] <- "a"
mcLM4_P_Tr$group[mcLM4_P_Tr$.group == 2] <- "b"
mcLM4_P_Tr
CM4_P_Tt <- Int_glm %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM4_P_Tt <- lmer(sqrt(n) ~ Area_gis_m_sq + Temperature + Periode + (1|Parcelle), data = CM4_P_Tt)
eLM4_P_Tt<-emmeans(LM4_P_Tt,"Periode")
mcLM4_P_Tt<-cld(eLM4_P_Tt,ajust="tukey")
mcLM4_P_Tt$.group<-as.numeric(mcLM4_P_Tt$.group)
mcLM4_P_Tt$group[mcLM4_P_Tt$.group == 1] <- "a"
mcLM4_P_Tt$group[mcLM4_P_Tt$.group == 2] <- "b"
mcLM4_P_Tt$group[mcLM4_P_Tt$.group == 12] <- "ab"
mcLM4_P_Tt



eLM4_Int_G5<-emmeans(LM4_Int,"Gestion_moment_5")
mcLM4_Int_G5<-cld(eLM4_Int_G5,ajust="tukey")
mcLM4_Int_G5$.group<-as.numeric(mcLM4_Int_G5$.group)
mcLM4_Int_G5$group[mcLM4_Int_G5$.group == 1] <- "a"
mcLM4_Int_G5$group[mcLM4_Int_G5$.group == 2] <- "b"
mcLM4_Int_G5$group[mcLM4_Int_G5$.group == 3] <- "c"
mcLM4_Int_G5$group[mcLM4_Int_G5$.group == 12] <- "ab"
mcLM4_Int_G5$group[mcLM4_Int_G5$.group == 4] <- "d"
mcLM4_Int_G5

CM4_G5_Ju <- Int_glm %>% 
  filter(Periode == "Juin")
LM4_G5_Ju <- lm(sqrt(n) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM4_G5_Ju)
eLM4_G5_Ju<-emmeans(LM4_G5_Ju,"Gestion_moment_5")
mcLM4_G5_Ju<-cld(eLM4_G5_Ju,ajust="tukey")
mcLM4_G5_Ju$.group<-as.numeric(mcLM4_G5_Ju$.group)
mcLM4_G5_Ju$group[mcLM4_G5_Ju$.group == 1] <- "a"
mcLM4_G5_Ju$group[mcLM4_G5_Ju$.group == 2] <- "b"
mcLM4_G5_Ju
CM4_G5_mJ <- Int_glm %>% 
  filter(Periode == "Mi-juillet")
LM4_G5_mJ <- lm(sqrt(n) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM4_G5_mJ)
eLM4_G5_mJ<-emmeans(LM4_G5_mJ,"Gestion_moment_5")
mcLM4_G5_mJ<-cld(eLM4_G5_mJ,ajust="tukey")
mcLM4_G5_mJ$.group<-as.numeric(mcLM4_G5_mJ$.group)
mcLM4_G5_mJ$group[mcLM4_G5_mJ$.group == 1] <- "a"
mcLM4_G5_mJ$group[mcLM4_G5_mJ$.group == 2] <- "b"
mcLM4_G5_mJ$group[mcLM4_G5_mJ$.group == 3] <- "c"
mcLM4_G5_mJ
CM4_G5_fJ <- Int_glm %>% 
  filter(Periode == "Fin juillet")
LM4_G5_fJ <- lm(sqrt(n) ~ Area_gis_m_sq + Temperature + Gestion_moment_5, data = CM4_G5_fJ)
eLM4_G5_fJ<-emmeans(LM4_G5_fJ,"Gestion_moment_5")
mcLM4_G5_fJ<-cld(eLM4_G5_fJ,ajust="tukey")
mcLM4_G5_fJ$.group<-as.numeric(mcLM4_G5_fJ$.group)
mcLM4_G5_fJ$group[mcLM4_G5_fJ$.group == 1] <- "a"
mcLM4_G5_fJ$group[mcLM4_G5_fJ$.group == 2] <- "b"
mcLM4_G5_fJ$group[mcLM4_G5_fJ$.group == 12] <- "ab"
mcLM4_G5_fJ
```




### LMM 5. Nombre de visites par unité florale par heure - nvis/fl.h
nvis./fl. h: Q où sp présente dans les 3 Q, sp phare, comparer période/gestion
```{r, warning=FALSE, message=FALSE}
Interactions_Gestion %>% 
  count(Sp_Pollinisateurs) %>% 
  arrange(desc(n))
  
Interactions_nvis_fl_h <- Interactions_Gestion %>% 
  filter(Sp_Pollinisateurs == "Apis mellifera"|
         Sp_Pollinisateurs == "Bombus pascuorum"|
         Sp_Pollinisateurs == "Bombus lapidarius"|
         Sp_Pollinisateurs == "Lasioglossum spec."|
         Sp_Pollinisateurs == "Hylaeus spec."|
         Sp_Pollinisateurs == "Episyrphus balteatus")

Q1 <- Interactions_nvis_fl_h %>% 
  filter(Nombre_quadrats == "1") %>% 
  mutate(nvis_fl_h = N_Interactions/(Qtte_Plantes/2))

Q2 <- Interactions_nvis_fl_h %>% 
  filter(Nombre_quadrats == "2") %>% 
  mutate(nvis_fl_h = N_Interactions/(Qtte_Plantes/4))

Q3 <- Interactions_nvis_fl_h %>% 
  filter(Nombre_quadrats == "3") %>%
  mutate(nvis_fl_h = N_Interactions/(Qtte_Plantes/6))

Interactions_nvis_fl_h <- full_join(Q1, Q2)
Interactions_nvis_fl_h <- full_join(Interactions_nvis_fl_h, Q3)
  

Interactions_nvis_fl_h %>% ggplot(aes (x = Sp_Pollinisateurs, y = nvis_fl_h, color = Gestion_moment_5)) + 
  geom_boxplot(alpha = 0.70) +
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  labs(#title = "", 
    x = "Sp_poll", y = "nvis_fl_h") +
   theme(legend.position = "bottom") +

Interactions_nvis_fl_h %>% ggplot(aes (x = Sp_Pollinisateurs, y = nvis_fl_h, color = Periode)) + 
  geom_boxplot(alpha = 0.70) +
     scale_color_manual(values = c(Juin = "#74a9cf",
                                 `Mi-juillet` = "#2b8cbe",
                                 `Fin juillet` = "#045a8d")) + 
  labs(#title = "", 
    x = "Sp_poll", y = "nvis_fl_h") +
   theme(legend.position = "bottom")
```

```{r, results = 'hide', warning=FALSE, message=FALSE}
LM5_nvis <- lmer(nvis_fl_h ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + Sp_Pollinisateurs + (1|Parcelle), data = Interactions_nvis_fl_h)
# check_model(LM5_nvis)
# shapiro.test(residuals(LM5_nvis))

LM5_nvis <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Periode * Gestion_moment_5 + Sp_Pollinisateurs + (1|Parcelle), data = Interactions_nvis_fl_h)
# check_model(LM5_nvis)
# shapiro.test(residuals(LM5_nvis))

step(LM5_nvis, direction = "backward")
# log(nvis_fl_h) ~ log(nvis_fl_h) ~ Temperature + Periode + Gestion_moment_5 + Sp_Pollinisateurs + (1 | Parcelle) + Periode:Gestion_moment_5
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM5_nvis)
Anova(LM5_nvis)
#summary(LM5_nvis)
#LM5_nvis

eLM5_nvis_P<-emmeans(LM5_nvis,"Periode")
mcLM5_nvis_P<-cld(eLM5_nvis_P,ajust="tukey")
mcLM5_nvis_P$.group<-as.numeric(mcLM5_nvis_P$.group)
mcLM5_nvis_P$group[mcLM5_nvis_P$.group == 1] <- "a"
mcLM5_nvis_P$group[mcLM5_nvis_P$.group == 2] <- "b"
mcLM5_nvis_P

CM5_P_G <- Interactions_nvis_fl_h %>% 
  filter(Gestion_moment_5 == "Graminées")
LM5_P_G <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Periode +  Sp_Pollinisateurs + (1|Parcelle), data = CM5_P_G)
eLM5_P_G<-emmeans(LM5_P_G,"Periode")
mcLM5_P_G<-cld(eLM5_P_G,ajust="tukey")
mcLM5_P_G$.group<-as.numeric(mcLM5_P_G$.group)
mcLM5_P_G$group[mcLM5_P_G$.group == 1] <- "a"
mcLM5_P_G$group[mcLM5_P_G$.group == 2] <- "b"
mcLM5_P_G$group[mcLM5_P_G$.group == 12] <- "ab"
mcLM5_P_G
CM5_P_F <- Interactions_nvis_fl_h %>% 
  filter(Gestion_moment_5 == "Fleuri")
LM5_P_F <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Periode + Sp_Pollinisateurs + (1|Parcelle), data = CM5_P_F)
eLM5_P_F<-emmeans(LM5_P_F,"Periode")
mcLM5_P_F<-cld(eLM5_P_F,ajust="tukey")
mcLM5_P_F$.group<-as.numeric(mcLM5_P_F$.group)
mcLM5_P_F$group[mcLM5_P_F$.group == 1] <- "a"
mcLM5_P_F$group[mcLM5_P_F$.group == 2] <- "b"
mcLM5_P_F$group[mcLM5_P_F$.group == 12] <- "ab"
mcLM5_P_F
CM5_P_S <- Interactions_nvis_fl_h %>% 
  filter(Gestion_moment_5 == "Semé")
LM5_P_S <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Periode + Sp_Pollinisateurs + (1|Parcelle), data = CM5_P_S)
eLM5_P_S<-emmeans(LM5_P_S,"Periode")
mcLM5_P_S<-cld(eLM5_P_S,ajust="tukey")
mcLM5_P_S$.group<-as.numeric(mcLM5_P_S$.group)
mcLM5_P_S$group[mcLM5_P_S$.group == 1] <- "a"
mcLM5_P_S$group[mcLM5_P_S$.group == 2] <- "b"
mcLM5_P_S$group[mcLM5_P_S$.group == 12] <- "ab"
mcLM5_P_S
CM5_P_Tr <- Interactions_nvis_fl_h %>% 
  filter(Gestion_moment_5 == "Tonte récente")
LM5_P_Tr <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Periode + Sp_Pollinisateurs + (1|Parcelle), data = CM5_P_Tr)
eLM5_P_Tr<-emmeans(LM5_P_Tr,"Periode")
mcLM5_P_Tr<-cld(eLM5_P_Tr,ajust="tukey")
mcLM5_P_Tr$.group<-as.numeric(mcLM5_P_Tr$.group)
mcLM5_P_Tr$group[mcLM5_P_Tr$.group == 1] <- "a"
mcLM5_P_Tr$group[mcLM5_P_Tr$.group == 2] <- "b"
mcLM5_P_Tr$group[mcLM5_P_Tr$.group == 12] <- "ab"
mcLM5_P_Tr
CM5_P_Tt <- Interactions_nvis_fl_h %>% 
  filter(Gestion_moment_5 == "Tonte tardive")
LM5_P_Tt <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Periode + Sp_Pollinisateurs + (1|Parcelle), data = CM5_P_Tt)
eLM5_P_Tt<-emmeans(LM5_P_Tt,"Periode")
mcLM5_P_Tt<-cld(eLM5_P_Tt,ajust="tukey")
mcLM5_P_Tt$.group<-as.numeric(mcLM5_P_Tt$.group)
mcLM5_P_Tt$group[mcLM5_P_Tt$.group == 1] <- "a"
mcLM5_P_Tt$group[mcLM5_P_Tt$.group == 2] <- "b"
mcLM5_P_Tt$group[mcLM5_P_Tt$.group == 12] <- "ab"
mcLM5_P_Tt

eLM5_nvis_G5<-emmeans(LM5_nvis,"Gestion_moment_5")
mcLM5_nvis_G5<-cld(eLM5_nvis_G5,ajust="tukey")
mcLM5_nvis_G5$.group<-as.numeric(mcLM5_nvis_G5$.group)
mcLM5_nvis_G5$group[mcLM5_nvis_G5$.group == 1] <- "a"
mcLM5_nvis_G5$group[mcLM5_nvis_G5$.group == 12] <- "ab"
mcLM5_nvis_G5$group[mcLM5_nvis_G5$.group == 23] <- "bc"
mcLM5_nvis_G5$group[mcLM5_nvis_G5$.group == 3] <- "c"
mcLM5_nvis_G5


CM5_G5_Ju <- Interactions_nvis_fl_h %>% 
  filter(Periode == "Juin")
LM5_G5_Ju <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Gestion_moment_5 + Sp_Pollinisateurs + (1|Parcelle), data = CM5_G5_Ju)
eLM5_G5_Ju<-emmeans(LM5_G5_Ju,"Gestion_moment_5")
mcLM5_G5_Ju<-cld(eLM5_G5_Ju,ajust="tukey")
mcLM5_G5_Ju$.group<-as.numeric(mcLM5_G5_Ju$.group)
mcLM5_G5_Ju$group[mcLM5_G5_Ju$.group == 1] <- "a"
mcLM5_G5_Ju$group[mcLM5_G5_Ju$.group == 2] <- "b"
mcLM5_G5_Ju$group[mcLM5_G5_Ju$.group == 12] <- "ab"
mcLM5_G5_Ju
CM5_G5_mJ <- Interactions_nvis_fl_h %>% 
  filter(Periode == "Mi-juillet")
LM5_G5_mJ <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Gestion_moment_5 + Sp_Pollinisateurs + (1|Parcelle), data = CM5_G5_mJ)
eLM5_G5_mJ<-emmeans(LM5_G5_mJ,"Gestion_moment_5")
mcLM5_G5_mJ<-cld(eLM5_G5_mJ,ajust="tukey")
mcLM5_G5_mJ$.group<-as.numeric(mcLM5_G5_mJ$.group)
mcLM5_G5_mJ$group[mcLM5_G5_mJ$.group == 1] <- "a"
mcLM5_G5_mJ$group[mcLM5_G5_mJ$.group == 2] <- "b"
mcLM5_G5_mJ$group[mcLM5_G5_mJ$.group == 12] <- "ab"
mcLM5_G5_mJ
CM5_G5_fJ <- Interactions_nvis_fl_h %>% 
  filter(Periode == "Fin juillet")
LM5_G5_fJ <- lmer(log(nvis_fl_h) ~ Area_gis_m_sq + Temperature + Gestion_moment_5 + Sp_Pollinisateurs + (1|Parcelle), data = CM5_G5_fJ)
eLM5_G5_fJ<-emmeans(LM5_G5_fJ,"Gestion_moment_5")
mcLM5_G5_fJ<-cld(eLM5_G5_fJ,ajust="tukey")
mcLM5_G5_fJ$.group<-as.numeric(mcLM5_G5_fJ$.group)
mcLM5_G5_fJ$group[mcLM5_G5_fJ$.group == 1] <- "a"
mcLM5_G5_fJ$group[mcLM5_G5_fJ$.group == 2] <- "b"
mcLM5_G5_fJ$group[mcLM5_G5_fJ$.group == 12] <- "ab"
mcLM5_G5_fJ$group[mcLM5_G5_fJ$.group == 23] <- "bc"
mcLM5_G5_fJ$group[mcLM5_G5_fJ$.group == 3] <- "c"
mcLM5_G5_fJ$group[mcLM5_G5_fJ$.group == 123] <- "abc"
mcLM5_G5_fJ


eLM5_nvis_spP<-emmeans(LM5_nvis,"Sp_Pollinisateurs")
mcLM5_nvis_spP<-cld(eLM5_nvis_spP,ajust="tukey")
mcLM5_nvis_spP$.group<-as.numeric(mcLM5_nvis_spP$.group)
mcLM5_nvis_spP$group[mcLM5_nvis_spP$.group == 1] <- "a"
mcLM5_nvis_spP$group[mcLM5_nvis_spP$.group == 2] <- "b"
mcLM5_nvis_spP$group[mcLM5_nvis_spP$.group == 12] <- "ab"
mcLM5_nvis_spP
```

### LMM 6. Tonte
#### S
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM6_Tonte_S <- lmer(S ~ Jour_af_tonte + (1|Site), data = expe_Tonte)
# check_model(LM6_Tonte_S)
# shapiro.test(residuals(LM6_Tonte_S))

LM6_Tonte_S <- lmer((S)^2 ~ Jour_af_tonte + (1|Site), data = expe_Tonte)
# check_model(LM6_Tonte_S)
# shapiro.test(residuals(LM6_Tonte_S))

step(LM6_Tonte_S, direction = "backward")
# (S)^2 ~ Jour_af_tonte
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM6_Tonte_S)
Anova(LM6_Tonte_S)
#summary(LM6_Tonte_S)
#LM6_Tonte_S
```


#### Ab
```{r, results = 'hide', warning=FALSE, message=FALSE}
LM6_Tonte_Ab <- lmer(Ab ~ Jour_af_tonte + (1|Site), data = expe_Tonte)
# check_model(LM6_Tonte_Ab)
# shapiro.test(residuals(LM6_Tonte_Ab))
LM6_Tonte_Ab <- lmer(sqrt(Ab) ~ Jour_af_tonte + (1|Site), data = expe_Tonte)

step(LM6_Tonte_Ab, direction = "backward")
# sqrt(Ab) ~ Jour_af_tonte + (1 | Site)
```
```{r, fig.width=8, fig.height=10, warning=FALSE, message=FALSE}
check_model(LM6_Tonte_Ab)
Anova(LM6_Tonte_Ab)
#summary(LM6_Tonte_Ab)
#LM6_Tonte_Ab
```



# Autres analyses
## Interactions vs pas d'interactions: tests d'homogénéité 
```{r, warning=FALSE, message=FALSE}
Interactions_Gestion$Inter_YN <- ifelse(Interactions_Gestion$N_Interactions == 0, 0, 1)
Interactions_Gestion %>% 
  group_by(Gestion_2, Inter_YN) %>% 
  mutate(Inter_YN = as.factor(Inter_YN)) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = Inter_YN, y = n, color = Gestion_2)) +
  geom_point(size = 3)

Interactions_Gestion %>% 
  group_by(Gestion_moment_5, Inter_YN) %>% 
  mutate(Inter_YN = as.factor(Inter_YN)) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = Inter_YN, y = n, color = Gestion_moment_5)) +
  geom_jitter(size = 3, width = 0.15) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) 

a <- Interactions_Gestion %>% 
  group_by(Gestion_moment_5) %>%  
  summarize(a = n())

b <- Interactions_Gestion %>% 
  group_by(Gestion_moment_5, Inter_YN) %>% 
  mutate(Inter_YN = as.factor(Inter_YN)) %>% 
  summarize(n = n()) 
c <- full_join(a,b)

c %>% 
  mutate(prop = n/a) %>% 
  filter(Inter_YN == 1) %>% 
  ggplot(aes(x = Gestion_moment_5, y = prop, color = Gestion_moment_5)) +
  geom_point(size = 3) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) 

Interactions_Gestion <- Interactions_Gestion %>% 
  mutate(Inter_YN = as.factor(Inter_YN))
levels(Interactions_Gestion$Inter_YN) <- c("Pas d'interactions","Interactions")

Interactions_Gestion %>% 
  group_by(Gestion_moment_5, Inter_YN) %>% 
  mutate(Inter_YN = as.factor(Inter_YN)) %>% 
  summarize(n = n()) %>% 
  ggplot(aes(x = Gestion_moment_5, y = n, color = Inter_YN)) +
  geom_jitter(size = 3, width = 0.15) 

Interactions_Gestion %>% 
  group_by(Gestion_moment_5, Inter_YN) %>% 
  mutate(Inter_YN = as.factor(Inter_YN)) %>%
  summarize(n = n()) %>% 
  ggplot(aes(x = Gestion_moment_5, y = n, color = Gestion_moment_5)) +
  facet_wrap(~Inter_YN) +
  geom_boxplot(alpha = 0.70) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) 
```

## Espèces de plantes ayant zero interactions
Totalité des quadrats
```{r}
Pl_zero <- Interactions_Gestion %>% 
  replace(is.na(.), 0) %>% 
  group_by(Sp_Plantes) %>% 
  summarise(data = sum(N_Interactions)) %>% 
  filter(data == 0)
Pl_zero 
```
16 espèces de plantes non-visitées, dans aucun quadrat!

## Nombre de changements de fleurs/sp
pour sp de poll. x individus : +ieurs fleurs en séquences
```{r, warning=FALSE, message=FALSE}
Interactions_indiv <-  Interactions_Classes %>% 
  filter(!is.na(individu)) %>% 
  mutate(Sp_pollinisateurs = Sp_Pollinisateurs) %>% 
  unite('Sp_unique', Sp_Pollinisateurs:individu)

seq <- Interactions_indiv %>% 
  count(Sp_unique) %>% 
  arrange(desc(n))
indiv_seq <- full_join(Interactions_indiv,seq)
sum <- Interactions_indiv %>% 
  group_by(Sp_unique) %>% 
  summarize(sum = sum(N_Interactions)) %>% 
  arrange(desc(sum))
join_sum <- full_join(Interactions_indiv, sum)
join_sum_n <- full_join(join_sum, indiv_seq)


join_sum_n %>% 
  ggplot(aes(x= Classe_Poll, y= sum, color = Gestion_2))+
  geom_boxplot(alpha = 0.70)
join_sum_n %>% 
  ggplot(aes(x= Sp_pollinisateurs, y= sum, color = Gestion_2))+
  geom_point()


join_sum_n %>% 
  mutate(n = as.factor(n)) %>% 
  ggplot(aes(x= Sp_pollinisateurs, y= sum, color = n))+
  geom_point()

join_sum_n %>% 
  mutate(n = as.factor(n)) %>% 
  ggplot(aes(x= Classe_Poll, y= sum, color = n))+
  geom_boxplot(alpha = 0.70)

join_sum_n %>% ggplot(aes(x= Sp_pollinisateurs, y= n, color = Classe_Poll))+
  geom_point()

join_sum_n %>% ggplot(aes(x= Classe_Poll, y= n, color = Gestion_2))+
  geom_point(size = 4)

Interactions_Gestion %>% 
  select(Site_gestion_date_Quadrat, Gestion_moment_5, Sp_Plantes, Sp_Pollinisateurs, individu, N_Interactions) %>% 
  filter(individu == "1315"|
           individu == "1434"|
           individu == "1325"|
           individu == "749"|
           individu == "536"|
           individu == "1202"|
           individu == "755")

length(unique(Interactions_indiv$Sp_Plantes))
```















# Graphiques finaux
## Heure
```{r, fig.width=8, fig.height=8}
ggplot(Inv) +
  aes(x = Heure_debut, y = Ab_Poll, color = Gestion_moment_5) +
  geom_point()+ 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  scale_x_discrete(breaks = c("09:00:00","10:00:00","11:00:00","12:00:00","13:00:00","14:00:00","15:00:00","16:00:00", "17:00:00")) +
  labs(x = "Heure", 
       y = "Abondance en pollinisateurs", 
       color = "Type de gestion") +
  theme(legend.position="bottom",
        legend.title = element_text(size= 12),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14))
```

## Meteo
```{r, fig.width=8, fig.height=8}
ggplot(Inv) +
  aes(x = Gestion_moment_5, y = Ab_Poll, color = Meteo) +
  geom_boxplot(alpha = 0.70) +
  scale_color_manual(values = c("Nuageux" = "#7f908c",
                                "Alternances" = "#79ccbd",
                                "Soleil" = "#fbcb09")) +
  labs(x = "Type de gestion", 
       y = "Abondance en pollinisateurs", 
       color = "Météo") +
  theme(legend.position="bottom",
        legend.title = element_text(size= 12),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14))
```

## Courbes d'accumulation
### Plantes
```{r, fig.width=9, fig.height=8}
ggplot(data=accum.long_Plantes_G2, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
    scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
    geom_line(aes(colour=Grouping), size=1.5) +
    geom_point(data=subset(accum.long_Plantes_G2, labelit==TRUE), 
               aes(colour=Grouping, shape=Grouping), size=2.5) +
      scale_shape_manual(values = c("Fauche" = 16,
                                  "Tonte" = 5)) +
    geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
                show.legend=FALSE) + 
    scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
    labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") + 
  theme(legend.position = c(0.85,0.07),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
ggplot(data=accum.long_Plantes_G5, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
  scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
  scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
  geom_line(aes(colour=Grouping), size=1.5) +
  geom_point(data=subset(accum.long_Plantes_G5, labelit==T), 
             aes(colour=Grouping, shape=Grouping), size=2.5) +
  scale_shape_manual(values = c("Graminées" = 16,
                                "Fleuri" = 17,
                                "Semé" = 15,
                                "Tonte récente" = 5,
                                "Tonte tardive" = 6)) +
  geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
              show.legend=FALSE) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de plantes", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = c(0.82,0.12),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14))  
```

### Pollinisateurs
```{r, fig.width=9, fig.height=8}
ggplot(data=accum.long_Poll_G2, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
  scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
  scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
  geom_line(aes(colour=Grouping), size=1.5) +
  geom_point(data=subset(accum.long_Poll_G2, labelit==TRUE), 
             aes(colour=Grouping, shape=Grouping), size=2.5) +
  scale_shape_manual(values = c("Fauche" = 16,
                                "Tonte" = 5)) +
  geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
              show.legend=FALSE) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") + 
    theme(legend.position = c(0.85,0.07),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
ggplot(data=accum.long_Poll_G5, aes(x = Sites, y = Richness, ymax = UPR, ymin = LWR)) + 
  scale_x_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
  scale_y_continuous(sec.axis = dup_axis(labels=NULL, name=NULL)) +
  geom_line(aes(colour=Grouping), size=1.5) +
  geom_point(data=subset(accum.long_Poll_G5, labelit==T), 
             aes(colour=Grouping, shape=Grouping), size=2.5) +
  scale_shape_manual(values = c("Graminées" = 16,
                                "Fleuri" = 17,
                                "Semé" = 15,
                                "Tonte récente" = 5,
                                "Tonte tardive" = 6)) + 
  geom_ribbon(aes(colour=Grouping, fill=after_scale(alpha(colour, alpha=0.15))), 
              show.legend=FALSE) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Nombre d'échantillonages", y = "Nombre d'espèces de pollinisateurs", colour = "Type de gestion", shape = "Type de gestion") +
  theme(legend.position = c(0.82,0.12),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14))  
```


## Analyses multivariées
Voir précédement
 
## Modèles Inventaires
### LM1_S_Pl
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Gestion_2, y = S_Plant)) + 
  geom_boxplot(aes (color = Gestion_2), alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en plantes") +
  theme(legend.position = "none",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
  geom_text(aes(label = "b", y = 14, x = 1),color="black") +
  geom_text(aes(label = "a", y = 7, x = 2),color="black")
```


### LM1_Ab_Pl 
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Periode, y = Ab_Plant)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) + 
  labs(#title = "Abondance en plantes en fonction des types de gestion", 
    x = "Période", y = "Abondance en plantes") +
  theme(legend.position = "none",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
  geom_text(aes(label = "b", y = 265, x =1),color="black") +
  geom_text(aes(label = "a", y = 210, x =2),color="black") +
  geom_text(aes(label = "a", y = 160, x =3),color="black") +
Inv %>% ggplot(aes (x = Temperature, y = Ab_Plant)) + 
  geom_point() +
  geom_smooth(method = "lm", se = T) +
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Température (°C)", y = "Abondance en plantes") + 
  theme(axis.text=element_text(size=12),
        axis.title=element_text(size=14))
```


### LM1_S_Po
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Gestion_2, y = S_Poll)) + 
  geom_boxplot(aes (color = Gestion_2), alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Richesse spécifique en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en pollinisateurs") +
  theme(legend.position = "none",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
  geom_text(aes(label = "b", y = 21.5, x =1),color="black") +
  geom_text(aes(label = "a", y = 10, x =2),color="black")
```


### LM1_Ab_Po 
```{r, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Gestion_2, y = Ab_Poll)) + 
  geom_boxplot(aes (color = Gestion_2), alpha = 0.70) + 
  scale_color_manual(values = c("Fauche" = "#aa1e0f",
                                "Tonte" = "#12661f")) +
  labs(#title = "Abondance en pollinisateurs en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en pollinisateurs") +
  theme(legend.position = "none",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
         geom_text(aes(label = "b", y = 55, x =1),color="black") +
  geom_text(aes(label = "a", y = 19, x =2),color="black")
```




### LM2_S_Pl 
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Periode, y = S_Plant)) +
  geom_boxplot(aes (color = Periode), alpha = 0.70) +
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) +
  labs(#title = "Abondance de plantes en fonction des types de gestion",
    x = "Période", y = "Richesse spécifique en plantes", color = "Période") +
  theme(legend.position = "none",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
  geom_text(aes(label = "a", y = 11.5, x =1),color="black") +
  geom_text(aes(label = "a", y = 9.5, x =2),color="black") +
  geom_text(aes(label = "a", y = 7.5, x =3),color="black") +
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Plant)) + 
   geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",#6dcf20
                                "Tonte tardive" = "#2b790c")) + #12661f
  labs(#title = "Richesse spécifique en plantes en fonction des types de gestion", 
    x = "Type de gestion", y = "Richesse spécifique en plantes") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
  geom_text(aes(label = "a", y = 6, x =1),color="black") +
  geom_text(aes(label = "a", y = 5, x =4),color="black") +
  geom_text(aes(label = "b", y = 7, x =5),color="black") +
  geom_text(aes(label = "bc", y = 12, x =2),color="black") +
  geom_text(aes(label = "c", y = 18, x =3),color="black") 
```

### LM2_Ab_Pl 
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Periode, y = Ab_Plant)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) +
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "Période", y = "Abondance en plantes", color = "Période") +
  theme(legend.position = "none",
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "b", y = 265, x =1),color="black") +
  geom_text(aes(label = "a", y = 210, x =2),color="black") +
  geom_text(aes(label = "a", y = 160, x =3),color="black") +
  Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Plant)) + 
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(#title = "Abondance de plantes en fonction des types de gestion", 
    x = "Type de gestion", y = "Abondance en plantes", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
      geom_text(aes(label = "a", y = 60, x =1),color="black") +
  geom_text(aes(label = "b", y = 270, x =2),color="black") +
  geom_text(aes(label = "b", y = 270, x =3),color="black") +
      geom_text(aes(label = "a", y = 110, x =4),color="black") +
  geom_text(aes(label = "b", y = 210, x =5),color="black") 
```

### LM2_S_Po
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Periode, y = S_Poll)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) +
  labs(x = "Période", y = "Richesse spécifique en pollinisateurs", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "a", y = 16.5, x = 1)) +
  geom_text(aes(label = "a", y = 19.5, x = 2)) +
  geom_text(aes(label = "a", y = 16.5, x = 3)) +
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Poll)) + 
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Type de gestion", y = "Richesse spécifique en pollinisateurs", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "ab", y = 12.5, x = 1)) +
  geom_text(aes(label = "c", y = 17.5, x = 2)) +
  geom_text(aes(label = "c", y = 21.5, x = 3)) +
  geom_text(aes(label = "a", y = 5.5, x = 4)) +
  geom_text(aes(label = "b", y = 9.5, x = 5))


data_text <- data.frame(label = c("a", "b", "b","a", "a", 
                                  "ab", "cd", "d","a", "bc",
                                  "b", "b", "b","a", "a"),
                        Periode = rep(c("Juin", "Mi-juillet", "Fin juillet"), each = 5),
                        x = c(1,2,3,4,5,
                              1,2,3,4,5,
                              1,2,3,4,5),
                        y = c(9,14,17,6,10,
                              10,18,20,5,6,
                              13,10,11,3,6))
data_text$Periode <- fct_relevel(data_text$Periode, c("Juin", "Mi-juillet", "Fin juillet"))
Inv %>% ggplot(aes (x = Gestion_moment_5, y = S_Poll)) + 
  facet_wrap(~Periode)+
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Type de gestion", y = "Richesse spécifique en pollinisateurs") +
  theme(legend.position = "none",
        #axis.title.x=element_blank(),
        legend.title = element_text(size=11), 
        legend.text = element_text(size=10),
        axis.text.y = element_text(size=10),
        axis.text.x = element_text(size=8),
        axis.title = element_text(size=14),
        strip.text = element_text(size=10)) +
   geom_text(data = data_text %>% filter(Periode == Periode), 
             mapping = aes(x = x, y = y, label = label),
             size = 4, fontface = "bold")
```

### LM2_Ab_Po
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Inv %>% ggplot(aes (x = Periode, y = Ab_Poll)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) +
  labs(x = "Période", y = "Abondance en pollinisateurs", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "a", y = 42.5, x = 1)) +
  geom_text(aes(label = "a", y = 45, x = 2)) +
  geom_text(aes(label = "a", y = 29, x = 3)) +
Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Poll)) + 
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Type de gestion", y = "Abondance en pollinisateurs", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "ab", y = 17.5, x = 1)) +
  geom_text(aes(label = "c", y = 45, x = 2)) +
  geom_text(aes(label = "d", y = 62, x = 3)) +
  geom_text(aes(label = "a", y = 9, x = 4)) +
  geom_text(aes(label = "b", y = 19, x = 5))


data_text <- data.frame(label = c("ab", "c", "c","a", "b", 
                                  "ab", "c", "d","a", "bc",
                                  "b", "ab", "b","a", "a"),
                        Periode = rep(c("Juin", "Mi-juillet", "Fin juillet"), each = 5),
                        x = c(1,2,3,4,5,
                              1,2,3,4,5,
                              1,2,3,4,5),
                        y = c(16,40,43,9,29,
                              19,45,63,6,20,
                              45,25,40,6,19))
data_text$Periode <- fct_relevel(data_text$Periode, c("Juin", "Mi-juillet", "Fin juillet"))
Inv %>% ggplot(aes (x = Gestion_moment_5, y = Ab_Poll)) + 
  facet_wrap(~Periode)+
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Type de gestion", y = "Abondance en pollinisateurs", color = "Type de gestion") +
  theme(legend.position = "none",
        legend.title = element_text(size=11), 
        legend.text = element_text(size=10),
        axis.text.y = element_text(size=10),
        axis.text.x = element_text(size=8),
        axis.title = element_text(size=14),
        strip.text = element_text(size=10)) +
   geom_text(data = data_text %>% filter(Periode == Periode), 
             mapping = aes(x = x, y = y, label = label),
             size = 4, fontface = "bold")
```


## Modèles Interactions
### LM3_Int : N_Int & qtté fleurs
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Interactions_Gestion %>% ggplot(aes (x = Qtte_Plantes, y = N_Interactions)) + 
  geom_point() +
  geom_smooth(method = "lm") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
  labs(x = "Quantité d'unités florales", y = "Nombre d'interactions") +
Interactions_Gestion %>% ggplot(aes (x = Temperature, y = N_Interactions)) + 
  geom_point() +
  geom_smooth(method = "lm") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
  labs(x = "Température (°C)", y = "Nombre d'interactions") +
Interactions_Gestion %>% ggplot(aes (x = Periode, y = N_Interactions)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) +
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) + 
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "a", y = 25, x = 1)) +
  geom_text(aes(label = "b", y = 26.5, x = 2)) +
  geom_text(aes(label = "b", y = 28, x = 3)) +
    labs(x = "Période", y = "Nombre d'interactions")
```
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Interactions_Gestion %>% ggplot(aes (x = Qtte_Plantes, y = N_Interactions)) + 
  geom_point(aes (color = Gestion_moment_5)) + 
  geom_smooth(aes (color = Gestion_moment_5), method = "lm", se = T) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) + 
  theme(legend.position = "bottom",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    labs(x = "Quantité d'unités florales", y = "Nombre d'interactions", color = "Type de gestion")


data_text <- data.frame(label = c("a", "b", "ab", 
                                  "a", "b", "ab",
                                  "a", "a", "a",
                                  "a", "a", "a",
                                  "a", "b", "ab"),
                        Gestion_moment_5 = rep(c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"), each = 3),
                        x = c(1,2,3,
                              1,2,3,
                              1,2,3,
                              1,2,3,
                              1,2,3),
                        y = c(8,8,8,
                              10,18,7,
                              11,13,14,
                              4,11,9,
                              25,27,28))
data_text$Gestion_moment_5 <- fct_relevel(data_text$Gestion_moment_5, c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
Interactions_Gestion %>% ggplot(aes (x = Periode, y = N_Interactions)) +
  facet_wrap(~Gestion_moment_5) +
 geom_boxplot(aes (color = Periode), alpha = 0.70) +
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) + 
  labs(x = "Période", y = "Nombre d'interactions", color = "Type de gestion") +
  theme(legend.position = "none",
        legend.title = element_text(size=11), 
        legend.text = element_text(size=10),
        axis.text.y = element_text(size=10),
        axis.text.x = element_text(size=8),
        axis.title = element_text(size=14),
        strip.text = element_text(size=10)) +
   geom_text(data = data_text %>% filter(Gestion_moment_5 == Gestion_moment_5), 
            mapping = aes(x = x, y = y, label = label),
            size = 4, fontface = "bold")
```

### LM4_Int : sum(N_Int) 
Température: voir LM3
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5, Temperature) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Temperature, y = n)) + 
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Température (°C)", y="Somme des interactions") +
  theme(axis.text=element_text(size=10),
        axis.title=element_text(size=14))


Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Periode, y = n)) + 
  geom_boxplot(aes (color = Periode), alpha = 0.70) + 
  scale_color_manual(values = c(Juin = "#74a9cf",
                                `Mi-juillet` = "#2b8cbe",
                                `Fin juillet` = "#045a8d")) +
  labs(x = "Période", y = "Somme des interactions", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "a", y = 137, x = 1)) +
  geom_text(aes(label = "a", y = 155, x = 2)) +
  geom_text(aes(label = "a", y = 75, x = 3)) +
Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Gestion_moment_5, y = n)) + 
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Type de gestion", y = "Somme des interactions", color = "Type de gestion") +
  theme(legend.position = "none",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14)) +
    geom_text(aes(label = "ab", y = 27, x = 1)) +
  geom_text(aes(label = "b", y = 91, x = 2)) +
  geom_text(aes(label = "c", y = 198, x = 3)) +
  geom_text(aes(label = "a", y = 48, x = 4)) +
  geom_text(aes(label = "b", y = 140, x = 5))


  
data_text <- data.frame(label = c("a", "b", "b","a", "b", 
                                  "a", "b", "c","a", "b",
                                  "ab", "ab", "b","a", "a"),
                        Periode = rep(c("Juin", "Mi-juillet", "Fin juillet"), each = 5),
                        x = c(1,2,3,4,5,
                              1,2,3,4,5,
                              1,2,3,4,5),
                        y = c(15,93,85,28,123,
                              25,80,198,10,113,
                              98,43,125,19,50))
data_text$Periode <- fct_relevel(data_text$Periode, c("Juin", "Mi-juillet", "Fin juillet"))
Interactions_Gestion %>% 
  group_by(Site_gestion_date, Periode, Gestion_moment_5) %>% 
  summarize(n= sum(N_Interactions)) %>% 
  ggplot(aes (x = Gestion_moment_5, y = n)) + 
  facet_wrap(~Periode)+
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
  scale_color_manual(values = c("Graminées" = "#fbcb09",
                                "Fleuri" = "#ff7207",
                                "Semé" = "#de1e21",
                                "Tonte récente" = "#6abe1d",
                                "Tonte tardive" = "#2b790c")) + 
  labs(x = "Type de gestion", y = "Somme des interactions", color = "Type de gestion") +
  theme(legend.position = "none",
        legend.title = element_text(size=11), 
        legend.text = element_text(size=10),
        axis.text.y = element_text(size=10),
        axis.text.x = element_text(size=8),
        axis.title = element_text(size=14),
        strip.text = element_text(size=10)) +
   geom_text(data = data_text %>% filter(Periode == Periode), 
             mapping = aes(x = x, y = y, label = label),
             size = 4, fontface = "bold")
```


### LM5_nvis : nvis_fl_h
#voir mod précédent effet t°, Periode
```{r, fig.width=9, fig.height=8}
Interactions_nvis_fl_h %>% 
  ggplot(aes (x = Periode, y = nvis_fl_h)) + 
  facet_wrap(~Sp_Pollinisateurs) +
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) +
    scale_y_continuous(trans='log10',
                     breaks=c(0.010, 0.100,1.000, 10),
                     labels=c("0.01","0.1","1", "10")) +
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(x = "Période", y = "Nombre de visites par unité florale par heure (nvis/uf.h)", color= "Type de gestion") +
     theme(legend.position = "bottom",
        legend.title = element_text(size=11), 
        legend.text = element_text(size=10),
        axis.text = element_text(size=11),
        axis.title = element_text(size=14),
        strip.text = element_text(size=10, face = "italic"))
```


## Interactions ou non
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
Interactions_Gestion %>% 
  group_by(Gestion_moment_5) %>% 
  summarize(tot = n())
E_O <- data.frame(Gestion_moment_5 = c(rep(c("Graminées","Graminées","Fleuri", "Fleuri","Semé","Semé","Tonte récente","Tonte récente","Tonte tardive","Tonte tardive"),2)),
                  EO = c(rep("O",10), rep("E",10)),
                  Inter_YN= c(rep(c("Pas d'interactions","Interactions"),10)),
                  EO_YN = c(rep(c("Pas d'interactions, observé","Interactions, observé"),5), rep(c("Pas d'interactions, attendu","Interactions, attendu"),5)),
                  totEO = c(16,92,89,563,99,666,27,51,87,378,16.61,91.39,100.26,551.74,117.64,647.36,11.99,66.01,71.50,393.50))
# n <- Interactions_Gestion %>%
#   group_by(Gestion_moment_5, Inter_YN) %>%
#   mutate(Inter_YN = as.factor(Inter_YN)) %>%
#   summarize(n = n())
# YN <- full_join(tot,n)
# YN %>% 
#   ggplot(aes(x = Gestion_moment_5, y= n, color = Gestion_moment_5, shape = Inter_YN)) +
#   geom_point(size = 4) +
#     scale_color_manual(guide = F, values = c("Graminées" = "#fbcb09",
#                                   "Fleuri" = "#ff7207",
#                                   "Semé" = "#de1e21",
#                                   "Tonte récente" = "#6abe1d",
#                                   "Tonte tardive" = "#2b790c")) +
#   scale_shape_manual(values = c("Pas d'interactions" = 15,
#                                   "Interactions" = 17)) +
#   guides(shape = guide_legend(title = "")) +
#   labs(x = "Type de gestion", y = "Compte") +
#   theme(legend.position = "bottom",
#         axis.text=element_text(size=10),
#         axis.title=element_text(size=14),
#         strip.text = element_text(size = 12))
E_O$Gestion_moment_5 <- fct_relevel(E_O$Gestion_moment_5,c("Graminées", "Fleuri", "Semé", "Tonte récente", "Tonte tardive"))
E_O %>% 
  ggplot(aes(x = Gestion_moment_5, y = totEO, color = Gestion_moment_5, shape = EO_YN)) +
  geom_point(size = 4) +
    scale_color_manual(guide = F, values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  scale_shape_manual(values = c("Pas d'interactions, observé" = 16,
                                  "Interactions, observé" = 17,
                                "Pas d'interactions, attendu" = 1,
                                  "Interactions, attendu" = 2)) +
  guides(shape = guide_legend(title = "")) +
  labs(x = "Type de gestion", y = "Compte") +
  theme(legend.position = "bottom",
        axis.text=element_text(size=14),
        axis.title=element_text(size=16),
        legend.text = element_text(size = 13))



ggplot(E_O) +
  aes(x = EO, fill = EO_YN, weight = totEO) +
  geom_bar() +
  scale_fill_manual(
    values = c("Interactions, attendu" = "#6DF875",
    "Interactions, observé" = "#31B425",
    "Pas d'interactions, attendu" = "#EE741F",
    "Pas d'interactions, observé" = "#E34524")
  ) +
  facet_wrap(vars(Gestion_moment_5), scales = "free")

ggplot(E_O) + aes(x = EO, y = totEO, fill = Inter_YN, colour = Gestion_moment_5) +
  geom_col() +
  scale_fill_manual(values = c("Interactions" = "#31B425",
                               "Pas d'interactions" = "#E34524")) +
   scale_color_manual(guide = F, values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  facet_wrap(vars(Gestion_moment_5),scales = "free") + 
  geom_hline(aes(yintercept= 16.61), color="#fbcb09")+
  geom_hline(yintercept= 100.26, color = "#ff7207")+
  geom_hline(yintercept= 117.64, color = "#de1e21")+
  geom_hline(yintercept= 11.99, color = "#6abe1d")+
  geom_hline(yintercept= 71.50, color = "#2b790c")

E_O %>% 
  filter(EO == "E")

E_O %>% 
  filter(EO == "O") %>% 
ggplot()+ aes(x = Gestion_moment_5, y = totEO, fill = Inter_YN, colour = Gestion_moment_5) +
  geom_col() +
  scale_fill_manual(values = c("Interactions" = "#31B425",
                               "Pas d'interactions" = "#E34524")) +
   scale_color_manual(guide = F, values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c"))

E_O %>% 
  filter(EO == "O") %>% 
ggplot()+ aes(x = Gestion_moment_5, y = totEO, fill = Inter_YN) +
  geom_col(alpha = 0.5) +
  scale_fill_manual(values = c("Interactions" = "#3da834",
                               "Pas d'interactions" = "#c54126")) +
   # scale_color_manual(guide = F, values = c("Graminées" = "#fbcb09",
   #                                "Fleuri" = "#ff7207",
   #                                "Semé" = "#de1e21",
   #                                "Tonte récente" = "#6abe1d",
   #                                "Tonte tardive" = "#2b790c")) +
  geom_segment(x = 0.5, xend = 1.5, y= 16.61, yend = 16.61, color="#fbcb09",linewidth=1)+
  geom_segment(x = 1.5, xend = 2.5,y= 100.26,yend= 100.26, color = "#ff7207",linewidth=1)+
  geom_segment(x = 2.5, xend = 3.5,y= 117.64,yend= 117.64, color = "#de1e21",linewidth=1)+
  geom_segment(x = 3.5, xend = 4.5,y= 11.99,yend= 11.99, color = "#6abe1d",linewidth=1)+
  geom_segment(x = 4.5, xend = 5.5,y= 71.50,yend= 71.50, color = "#2b790c",linewidth=1) +
    theme(legend.position = c(0.9,0.97),
        legend.text = element_text(size=10),
        axis.text=element_text(size=12),
        axis.title=element_text(size=14)) + 
  labs(x= "Type de gestion", y = "Compte", fill = "")

```


## Nombre de changements de fleurs/sp
```{r, fig.width=9, fig.height=8, warning=FALSE, message=FALSE}
join_sum_n <- join_sum_n %>% 
  mutate(n = as.factor(n))
levels(join_sum_n$n) <- c("1 espèce visitée", "2 espèces visitées", "3 espèces visitées")
join_sum_n %>% 
  ggplot(aes(x = Classe_Poll, y = sum))+
  facet_wrap(~n) +
  geom_boxplot(aes (color = Gestion_moment_5), alpha = 0.70) + 
    scale_color_manual(values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(x = "Catégories de pollinisateurs", y = "Nombre d'unités florales visitées en séquence", color = "Type de gestion", title = "Nombre d'espèces de plantes en fleur différentes visitées") + 
  theme(legend.position = "bottom", 
        axis.text.x = element_text(size = 6),
        axis.text.y=element_text(size=10),
        axis.title=element_text(size=14),
         strip.text = element_text(size = 12),
        axis.title.y=element_text(angle=-90, vjust=0.5))
```

## Réseaux Plantes_pollinisateurs
```{r, fig.width=10, fig.height=8}
plotweb(network_fauche, high.lablength= 35, low.lablength=27, col.high=c("#aa1e0f"),col.low=c("#aa1e0f"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_tonte, high.lablength= 35, low.lablength=27, col.high=c("#12661f"),col.low=c("#12661f"),text.rot=90,y.width.high=0.07, y.width.low=0.07,y.lim=c(-1,3.5))

plotweb(network_gram, high.lablength= 35, low.lablength=27,  col.high=c("#fbcb09"),col.low=c("#fbcb09"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_fleuri, high.lablength= 35, low.lablength=27,  col.high=c("#ff7207"),col.low=c("#ff7207"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_seme, high.lablength= 35, low.lablength=27,  col.high=c("#de1e21"),col.low=c("#de1e21"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_TonRec, high.lablength= 35, low.lablength=27,  col.high=c("#6abe1d"), col.low=c("#6abe1d"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_TonTard, high.lablength= 35, low.lablength=27,  col.high=c("#2b790c"), col.low=c("#2b790c"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))

plotweb(network_Juin, high.lablength= 35, low.lablength=27,  col.high=c("#74a9cf"), col.low=c("#74a9cf"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_miJuil, high.lablength= 35, low.lablength=27,  col.high=c("#2b8cbe"), col.low=c("#2b8cbe"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
plotweb(network_finJuil, high.lablength= 35, low.lablength=27,  col.high=c("#045a8d"), col.low=c("#045a8d"), text.rot=90, y.width.high=0.07, y.width.low=0.07, y.lim=c(-1,3.5))
```

```{r, fig.width=9, fig.height=8}
Table_NW_P 
# %>%
  # kbl(caption = "Période") %>%
  # kable_classic(full_width = F, html_font = "Cambria") #%>% kable_styling() %>%
#save_kable(file = "Output/Tableau/NW_P.pdf")
Table_NW_G2 
# %>% 
#   kbl(caption = "Gestion - biclassification") %>%
#   kable_classic(full_width = F, html_font = "Cambria") # %>% kable_styling() %>%
 # save_kable(file = "Output/Tableau/NW_G2.pdf")
Table_NW_G5 
# %>%
#   kbl(caption = "Gestion - pentaclassification") %>%
#   kable_classic(full_width = F, html_font = "Cambria") #%>% kable_styling() %>%
# save_kable(file = "Output/Tableau/NW_G5.pdf")

# write.csv2(Table_NW_G5, file = "Output/Tableau/NW_G5.csv")
# write.csv2(Table_NW_G2, file = "Output/Tableau/NW_G2.csv")
# write.csv2(Table_NW_P, file = "Output/Tableau/NW_P.csv")
```



## Tonte
### LM6_Tonte_S
```{r, warning=FALSE, message=FALSE}
Tonte_pl %>% ggplot(aes (x = Jour_af_tonte, y = S, color = Site)) + 
  geom_point() +
  geom_smooth(se = F)+
  scale_x_continuous(n.breaks=17)+
  labs(x = "Jour après la tonte", y = "Richesse spécifique en plantes") +
        theme(legend.position = "bottom",
        axis.text=element_text(size=10),
        axis.title=element_text(size=14))
```

### LM6_Tonte_Ab
```{r, warning=FALSE, message=FALSE}
Tonte_pl %>% ggplot(aes (x = Jour_af_tonte, y = Qtté, color=Espèces)) + 
  facet_wrap(~Site) +
  geom_smooth(se = F)+
  scale_color_viridis_d(option = "viridis", direction = -1) +
  geom_point(shape = "circle", size = 1.5) +
  scale_x_continuous(n.breaks=17) +
  labs(x = "Jour après la tonte", y = "Abondance en plantes") +
           theme(legend.position = "right", 
        axis.text=element_text(size=10),
        axis.title=element_text(size=14),
         strip.text = element_text(size = 12)) +
  theme_classic()
```


## Estimation % diversité totale
```{r}
Estim <- Inventaire %>% 
  rownames_to_column(var = "temp")
Estim <- Estim[,c(12, 20:167)]

Estim <- aggregate(.~ Gestion_moment_5, data=Estim, FUN= "sum")

Estim$S_Pl <- specnumber(Estim[2:50])
Estim$Ab_Plant <- rowSums(Estim[2:50])
Estim$S_Poll <- specnumber(Estim[51:149])
Estim$Ab_Poll <- rowSums(Estim[51:149])

Estim <- Estim[, c(1,150:153)]
Estim$Pl_tot <- Estim$S_Pl/49
Estim$Poll_tot <- Estim$S_Poll/99
```

```{r}
# Plantes : 49 sp au total dans les quadrats
# Pollinisateurs: 99 sp au total dans les quadrats
shape <- c("Plantes" = 8, "Pollinisateurs" = 19)
Estim %>% 
  ggplot(aes(x = Gestion_moment_5)) + 
  geom_point(aes(y = Pl_tot, color = Gestion_moment_5, shape = "Plantes"), 
             size = 3) + 
  geom_point(aes(y = Poll_tot, color = Gestion_moment_5, shape = "Pollinisateurs"), size = 3) +
      scale_shape_manual(values = shape) +
      scale_color_manual(guide = 'none',values = c("Graminées" = "#fbcb09",
                                  "Fleuri" = "#ff7207",
                                  "Semé" = "#de1e21",
                                  "Tonte récente" = "#6abe1d",
                                  "Tonte tardive" = "#2b790c")) +
  labs(x = "Type de gestion", y = "Proportion d'espèces relative à la diversité totale", shape = "") +
  # pour chaque type de gestion sur le nombre total\n d'espèces rencontrées sur l'ensemble des quadrats
  theme(legend.position = c(0.9,0.95),
        legend.text = element_text(size=10),
        axis.text=element_text(size=10),
        axis.title=element_text(size=14))
